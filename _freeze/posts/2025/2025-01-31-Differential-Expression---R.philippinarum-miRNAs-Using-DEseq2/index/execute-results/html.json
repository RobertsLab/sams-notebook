{
  "hash": "a2c2166a72e9875949834796d8da5849",
  "result": {
    "engine": "knitr",
    "markdown": "---\nauthor: Sam White\ntoc-title: Contents\ntoc-depth: 5\ntoc-location: left\ntitle: Differential Expression - R.philippinarum miRNAs Using DEseq2\ndate: '2025-01-31'\ndraft: false\nengine: knitr\ncategories: \n  - \"2025\"\n  - \"Ruditapes philippinarum\"\n  - \"Manila clam\"\n  - \"DEseq2\"\n  - \"sRNA-seq\"\n  - \"miRNA\"\n---\n\n\n\nThis analysis was done as part of [`project-clam-oa`](https://github.com/RobertsLab/project-clam-oa) (GitHub repo).\n\n::: {.callout-note}\nThe contents below are from markdown knitted from [`03.00-D-sRNAseq-gene-expression-DESeq2.Rmd`](https://github.com/RobertsLab/project-clam-oa/blob/3eb5caaa2d7906f182450877a4df6bad61e5e14e/code/03.00-sRNAseq-gene-expression-DESeq2.Rmd) (commit `3eb5caa`).\n:::\n\n\n\n# 1 Background\n\nThis will run\n[DEseq2](https://bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html)\n(Love, Huber, and Anders 2014) to determine if any of the miRNAs\nidentified by ShortStack in\n[02.00-ShortStack-31bp-fastp-merged.md](https://github.com/RobertsLab/project-clam-oa/blob/2616d45a5a0bbef23081c5824bfe5bad6b89d227/code/02.00-ShortStack-31bp-fastp-merged.md)\nanalysis are differentially expressed between control/treatment.\n\nThis was initially run with a log2 fold change threshold set to 1 (which\nis equivalent to a 2-fold change in expression), but that returned 0\ndifferentially expressed miRNAs. As such, this was run again with the\nlog2 fold change threshold set to 0.\n\n<div class=\"callout-note\">\n\nShortStack identified 37 miRNAs.\n\n</div>\n\nThis notebook will also run\n[DEseq2](https://bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html)\n(Love, Huber, and Anders 2014) on *all* sRNAs to identify any\ndifferential expression.\n\n<div class=\"callout-important\">\n\nThis includes the 37 miRNAs identified by ShortStack.\n\n</div>\n\n## 1.1 Inputs\n\n- [`Counts.txt`](https://github.com/RobertsLab/project-clam-oa/blob/d380ed9a88c874db5434c9ec74f6ab1de042bad5/output/02.00-ShortStack-31bp-fastp-merged/ShortStack_out/Counts.txt):\n  ShortStack counts matrix. Includes all clusters, including those that\n  were *not* categorized as miRNAs.\n\n- [`DESeq2-coldata.tab`](https://github.com/RobertsLab/project-clam-oa/blob/d380ed9a88c874db5434c9ec74f6ab1de042bad5/output/03.00-sRNAseq-gene-expression-DESeq2/DESeq2-coldata.tab):\n  Two column table with sample ID and treatment. This file is also an\n  output from this notebook.\n\n- [ManilaOA2023_shortRNASeq_Meta.csv](https://github.com/RobertsLab/project-clam-oa/blob/d380ed9a88c874db5434c9ec74f6ab1de042bad5/data/ManilaOA2023_shortRNASeq_Meta.csv):\n  Metadata file for this sRNA-seq data.\n\n## 1.2 Outputs\n\n- [`DE-miRNAs.fdr-0.05.lfc-0.tab`](https://github.com/RobertsLab/project-clam-oa/blob/3a9131cc5af82e756990d735b1ad56aecc32008c/output/03.00-sRNAseq-gene-expression-DESeq2/DE-miRNAs.fdr-0.05.lfc-0.tab):\n  Tab-delimited list of differentially expressed miRNA “clusters” from\n  the ShortStack `Results.txt` file.\n\n- [`DE-sRNAs.fdr-0.05.lfc-0.tab`](https://github.com/RobertsLab/project-clam-oa/blob/3a9131cc5af82e756990d735b1ad56aecc32008c/output/03.00-sRNAseq-gene-expression-DESeq2/DE-sRNAs.fdr-0.05.lfc-0.tab):\n  Tab-delimited list of differentially expressed sRNA “clusters” from\n  the ShortStack `Results.txt` file. Since this is any sRNA, results may\n  also include miRNAs identified by ShortStack.\n\n- [`DESeq2-coldata.tab`](https://github.com/RobertsLab/project-clam-oa/blob/3a9131cc5af82e756990d735b1ad56aecc32008c/output/03.00-sRNAseq-gene-expression-DESeq2/DESeq2-coldata.tab):\n  Two column table with sample ID and treatment. Needed as input to\n  DEseq2.\n\n- [`deseq2.miRNAs.fdr-0.05.lfc-0.table.csv`](https://github.com/RobertsLab/project-clam-oa/blob/3a9131cc5af82e756990d735b1ad56aecc32008c/output/03.00-sRNAseq-gene-expression-DESeq2/deseq2.miRNAs.fdr-0.05.lfc-0.table.csv):\n  DEseq2 miRNA output table of results with adjusted p-value \\<= 0.05\n  and a log<sub>2</sub> fold change value = 0.\n\n- [`deseq2.miRNAs.table.csv`](https://github.com/RobertsLab/project-clam-oa/blob/3a9131cc5af82e756990d735b1ad56aecc32008c/output/03.00-sRNAseq-gene-expression-DESeq2/deseq2.miRNAs.table.csv):\n  Unfiltered DEseq2 miRNA output table containing all results with mean\n  expression, fold change in expression, and adjusted p-values for all\n  input samples.\n\n- [`deseq2.sRNAs.fdr-0.05.lfc-0.table.csv`](https://github.com/RobertsLab/project-clam-oa/blob/3a9131cc5af82e756990d735b1ad56aecc32008c/output/03.00-sRNAseq-gene-expression-DESeq2/deseq2.sRNAs.fdr-0.05.lfc-0.table.csv):\n  DEseq2 sRNA output table of results with adjusted p-value \\<= 0.05 and\n  a log<sub>2</sub> fold change value = 0.\n\n- [`deseq2.sRNAs.table.csv`](https://github.com/RobertsLab/project-clam-oa/blob/3a9131cc5af82e756990d735b1ad56aecc32008c/output/03.00-sRNAseq-gene-expression-DESeq2/deseq2.sRNAs.table.csv):\n  Unfiltered DEseq2 sRNA output table containing all results with mean\n  expression, fold change in expression, and adjusted p-values for all\n  input samples.\n\n# 2 Set R variables\n\n``` r\n# Define the output directory path\noutput_dir <- \"../output/03.00-sRNAseq-gene-expression-DESeq2/\"\n\n# Set desired false discovery rate threshold (i.e. adjusted p-value, padj)\nfdr <- 0.05\n\n# Set log2 fold change threshold (a value of '1' is equal to a fold change of '2')\nlog2fc <- 0\n```\n\n# 3 Load count data\n\nLoad in the sRNA count matrix generated using ShortStack 4.1.1. Keep in\nmind this data includes counts of all sRNAs, not just miRNAs.\n\nCounts generated in `02.00-ShortStack-31bp-fastp-merged`.\n\n## 3.1 Select only miRNAs IDd by ShortStack\n\n``` r\n# Read in sRNA counts data\nmiRNA_seq_counts_shortstack <- read_delim(\"../output/02.00-ShortStack-31bp-fastp-merged/ShortStack_out/Counts.txt\", delim=\"\\t\")\n\nmiRNA_seq_counts_shortstack <- miRNA_seq_counts_shortstack %>% filter(MIRNA == \"Y\")\n\nstr(miRNA_seq_counts_shortstack)\n```\n\n    spc_tbl_ [37 × 23] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n     $ Coords                                        : chr [1:37] \"NW_026852415.1:231396-231495\" \"NW_026852524.1:285406-285505\" \"NW_026852815.1:56435-56532\" \"NW_026853363.1:213466-213568\" ...\n     $ Name                                          : chr [1:37] \"Cluster_1785\" \"Cluster_2042\" \"Cluster_2646\" \"Cluster_3720\" ...\n     $ MIRNA                                         : chr [1:37] \"Y\" \"Y\" \"Y\" \"Y\" ...\n     $ 196-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 693 108457 1808 37 9 ...\n     $ 199-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 503 137906 1592 24 4 ...\n     $ 211-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 663 154248 2026 23 2 ...\n     $ 24-fastp-adapters-polyG-31bp-merged_condensed : num [1:37] 557 136805 1276 34 8 ...\n     $ 260-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 1419 120261 1468 178 8 ...\n     $ 26-fastp-adapters-polyG-31bp-merged_condensed : num [1:37] 559 124995 1580 29 0 ...\n     $ 30-fastp-adapters-polyG-31bp-merged_condensed : num [1:37] 780 157279 2265 19 4 ...\n     $ 310-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 569 154690 1765 15 2 ...\n     $ 33-fastp-adapters-polyG-31bp-merged_condensed : num [1:37] 442 116913 1420 13 9 ...\n     $ 341-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 728 121161 1344 7 2 ...\n     $ 34-fastp-adapters-polyG-31bp-merged_condensed : num [1:37] 665 143730 1736 14 5 ...\n     $ 35-fastp-adapters-polyG-31bp-merged_condensed : num [1:37] 607 128534 1683 26 1 ...\n     $ 363-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 538 95266 1408 15 6 ...\n     $ 367-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 520 119389 1315 7 1 ...\n     $ 376-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 1029 217736 2833 14 2 ...\n     $ 460-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 571 139439 1466 9 6 ...\n     $ 485-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 579 154776 1747 11 4 ...\n     $ 501-fastp-adapters-polyG-31bp-merged_condensed: num [1:37] 1182 167181 2135 174 3 ...\n     $ 71-fastp-adapters-polyG-31bp-merged_condensed : num [1:37] 392 1097 11123 1248 5 ...\n     $ 88-fastp-adapters-polyG-31bp-merged_condensed : num [1:37] 552 136133 1808 9 1 ...\n     - attr(*, \"spec\")=\n      .. cols(\n      ..   Coords = col_character(),\n      ..   Name = col_character(),\n      ..   MIRNA = col_character(),\n      ..   `196-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `199-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `211-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `24-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `260-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `26-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `30-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `310-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `33-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `341-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `34-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `35-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `363-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `367-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `376-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `460-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `485-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `501-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `71-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `88-fastp-adapters-polyG-31bp-merged_condensed` = col_double()\n      .. )\n     - attr(*, \"problems\")=<externalptr> \n\n## 3.2 All sRNA-seq counts\n\n``` r\n# Read in sRNA counts data\nsrna_seq_counts_all <- read_delim(\"../output/02.00-ShortStack-31bp-fastp-merged/ShortStack_out/Counts.txt\", delim=\"\\t\")\n\nstr(srna_seq_counts_all)\n```\n\n    spc_tbl_ [33,666 × 23] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n     $ Coords                                        : chr [1:33666] \"NW_026851514.1:11444-11873\" \"NW_026851514.1:12401-12830\" \"NW_026851515.1:76365-77030\" \"NW_026851515.1:77089-77506\" ...\n     $ Name                                          : chr [1:33666] \"Cluster_1\" \"Cluster_2\" \"Cluster_3\" \"Cluster_4\" ...\n     $ MIRNA                                         : chr [1:33666] \"N\" \"N\" \"N\" \"N\" ...\n     $ 196-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 39 33 179 34 279 68 28 233 40 0 ...\n     $ 199-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 14 24 7 0 12 2 0 11 1 1 ...\n     $ 211-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 214 40 979 31 401 35 106 492 56 0 ...\n     $ 24-fastp-adapters-polyG-31bp-merged_condensed : num [1:33666] 102 35 311 10 111 16 43 74 15 0 ...\n     $ 260-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 39 21 132 1 123 21 5 124 23 2 ...\n     $ 26-fastp-adapters-polyG-31bp-merged_condensed : num [1:33666] 0 0 808 87 388 20 8 827 215 0 ...\n     $ 30-fastp-adapters-polyG-31bp-merged_condensed : num [1:33666] 12 7 448 21 165 26 39 117 38 3 ...\n     $ 310-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 43 13 857 25 153 0 5 165 3 2 ...\n     $ 33-fastp-adapters-polyG-31bp-merged_condensed : num [1:33666] 1 1 320 26 225 24 35 177 97 3 ...\n     $ 341-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 220 41 671 7 110 19 4 92 32 0 ...\n     $ 34-fastp-adapters-polyG-31bp-merged_condensed : num [1:33666] 34 32 1413 28 795 ...\n     $ 35-fastp-adapters-polyG-31bp-merged_condensed : num [1:33666] 103 40 497 24 126 57 37 116 29 3 ...\n     $ 363-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 60 16 833 117 441 89 45 827 200 0 ...\n     $ 367-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 40 132 426 6 127 23 19 122 127 0 ...\n     $ 376-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 0 16 2409 187 978 ...\n     $ 460-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 3 0 331 17 149 40 41 260 28 2 ...\n     $ 485-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 5 42 5 0 42 4 4 106 2 0 ...\n     $ 501-fastp-adapters-polyG-31bp-merged_condensed: num [1:33666] 4 1 363 6 76 ...\n     $ 71-fastp-adapters-polyG-31bp-merged_condensed : num [1:33666] 0 0 31 123 671 37 2 691 135 0 ...\n     $ 88-fastp-adapters-polyG-31bp-merged_condensed : num [1:33666] 1 41 633 48 354 45 52 200 77 0 ...\n     - attr(*, \"spec\")=\n      .. cols(\n      ..   Coords = col_character(),\n      ..   Name = col_character(),\n      ..   MIRNA = col_character(),\n      ..   `196-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `199-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `211-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `24-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `260-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `26-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `30-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `310-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `33-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `341-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `34-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `35-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `363-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `367-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `376-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `460-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `485-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `501-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `71-fastp-adapters-polyG-31bp-merged_condensed` = col_double(),\n      ..   `88-fastp-adapters-polyG-31bp-merged_condensed` = col_double()\n      .. )\n     - attr(*, \"problems\")=<externalptr> \n\n# 4 Create DESeq2 Column Data\n\n## 4.1 Read in metadata CSV\n\n``` r\n# Load metadata\nmetadata <- read.csv(\"../data/ManilaOA2023_shortRNASeq_Meta.csv\", header = TRUE)\n\nstr(metadata)\n```\n\n    'data.frame':   20 obs. of  6 variables:\n     $ ID_simple  : int  196 199 211 310 341 363 367 376 460 485 ...\n     $ treatment  : chr  \"control\" \"control\" \"control\" \"control\" ...\n     $ Sex        : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...\n     $ MeanEggArea: int  NA 3687 3519 3795 3837 3749 NA 3834 3759 NA ...\n     $ Species    : chr  \"Manila clam\" \"Manila clam\" \"Manila clam\" \"Manila clam\" ...\n     $ LifeStage  : chr  \"Adult\" \"Adult\" \"Adult\" \"Adult\" ...\n\n## 4.2 Extract sample names\n\n``` r\nsample_names <- colnames(miRNA_seq_counts_shortstack) %>%\n  str_subset(\"^\\\\d+-\") %>%\n  str_extract(\"^\\\\d+\")\n\nstr(sample_names)\n```\n\n     chr [1:20] \"196\" \"199\" \"211\" \"24\" \"260\" \"26\" \"30\" \"310\" \"33\" \"341\" \"34\" ...\n\n## 4.3 Select sample name and treatment\n\n``` r\nsample_treatment_df <- metadata %>%\n  select(ID_simple, treatment)\n\n# Set sample names as rownames\nrownames(sample_treatment_df) <- sample_treatment_df$ID_simple\n\nsample_treatment_df$ID_simple <- NULL\n\nstr(sample_treatment_df)\n```\n\n    'data.frame':   20 obs. of  1 variable:\n     $ treatment: chr  \"control\" \"control\" \"control\" \"control\" ...\n\n## 4.4 Write DEseq coldata to file\n\n``` r\nwrite.table(\n  sample_treatment_df,\n  file = \"../output/03.00-sRNAseq-gene-expression-DESeq2/DESeq2-coldata.tab\",\n  sep = \"\\t\",\n  quote = FALSE,\n  col.names = NA\n)\n```\n\n# 5 SHORTSTACK miRNAS\n\n## 5.1 Count data munging\n\n### 5.1.1 Fix col names and convert to matrix\n\n``` r\ncoldata <- sample_treatment_df\n\n# Remove excess portions of sample column names to just \"sample###\"\ncolnames(miRNA_seq_counts_shortstack) <- sub(\"-fastp-adapters-polyG-31bp-merged_condensed\", \"\", colnames(miRNA_seq_counts_shortstack))\n\n# Keep just the counts and cluster names as matrix\nmiRNA_seq_counts_matrix <- as.matrix(miRNA_seq_counts_shortstack %>% select(-Coords, -MIRNA) %>% column_to_rownames(var = \"Name\"))\n\nstr(miRNA_seq_counts_matrix)\n```\n\n     num [1:37, 1:20] 693 108457 1808 37 9 ...\n     - attr(*, \"dimnames\")=List of 2\n      ..$ : chr [1:37] \"Cluster_1785\" \"Cluster_2042\" \"Cluster_2646\" \"Cluster_3720\" ...\n      ..$ : chr [1:20] \"196\" \"199\" \"211\" \"24\" ...\n\n### 5.1.2 Take only samples present in coldata\n\n``` r\nmiRNA_common_cols <- intersect(colnames(miRNA_seq_counts_matrix),\n                         rownames(sample_treatment_df))\n\nmiRNA_seq_counts_matrix <- miRNA_seq_counts_matrix[, miRNA_common_cols]\n\nstr(miRNA_seq_counts_matrix)\n```\n\n     num [1:37, 1:20] 693 108457 1808 37 9 ...\n     - attr(*, \"dimnames\")=List of 2\n      ..$ : chr [1:37] \"Cluster_1785\" \"Cluster_2042\" \"Cluster_2646\" \"Cluster_3720\" ...\n      ..$ : chr [1:20] \"196\" \"199\" \"211\" \"24\" ...\n\n### 5.1.3 Reorder matrix cols to match coldata\n\n``` r\nmiRNA_ord <- match(rownames(sample_treatment_df), colnames(miRNA_seq_counts_matrix))\n\nmiRNA_seq_counts_matrix_sorted <- miRNA_seq_counts_matrix[, miRNA_ord]\n\nstr(miRNA_seq_counts_matrix_sorted)\n```\n\n     num [1:37, 1:20] 693 108457 1808 37 9 ...\n     - attr(*, \"dimnames\")=List of 2\n      ..$ : chr [1:37] \"Cluster_1785\" \"Cluster_2042\" \"Cluster_2646\" \"Cluster_3720\" ...\n      ..$ : chr [1:20] \"196\" \"199\" \"211\" \"310\" ...\n\n### 5.1.4 Verify rownames match\n\n``` r\nall(rownames(coldata) == colnames(miRNA_seq_counts_matrix_sorted))\n```\n\n    [1] TRUE\n\n## 5.2 Create DESeq2 data set\n\n### 5.2.1 Initialize DEseq2 data set\n\n``` r\nmiRNA_dds <- DESeqDataSetFromMatrix(countData = miRNA_seq_counts_matrix_sorted,\n                              colData = coldata,\n                              design = ~ treatment)\nmiRNA_dds\n```\n\n    class: DESeqDataSet \n    dim: 37 20 \n    metadata(1): version\n    assays(1): counts\n    rownames(37): Cluster_1785 Cluster_2042 ... Cluster_32918 Cluster_32919\n    rowData names(0):\n    colnames(20): 196 199 ... 71 260\n    colData names(1): treatment\n\n### 5.2.2 Add cluster column as “gene” feature\n\n``` r\nmiRNA_featureData <- data.frame(gene=rownames(miRNA_seq_counts_matrix_sorted))\nmcols(miRNA_dds) <- DataFrame(mcols(miRNA_dds), miRNA_featureData)\nmcols(miRNA_dds)\n```\n\n    DataFrame with 37 rows and 1 column\n                           gene\n                    <character>\n    Cluster_1785   Cluster_1785\n    Cluster_2042   Cluster_2042\n    Cluster_2646   Cluster_2646\n    Cluster_3720   Cluster_3720\n    Cluster_4396   Cluster_4396\n    ...                     ...\n    Cluster_29018 Cluster_29018\n    Cluster_31844 Cluster_31844\n    Cluster_32917 Cluster_32917\n    Cluster_32918 Cluster_32918\n    Cluster_32919 Cluster_32919\n\n### 5.2.3 Set factor levels\n\n``` r\nmiRNA_dds$treatment <- factor(miRNA_dds$treatment, levels = c(\"control\", \"treatment\"))\n```\n\n## 5.3 DESeq analysis\n\n### 5.3.1 DEseq\n\n``` r\nmiRNA_dds <- DESeq(miRNA_dds)\n```\n\n### 5.3.2 DEseq Results\n\n``` r\nmiRNA_res <- results(miRNA_dds, alpha = fdr, lfcThreshold = log2fc)\n\nmiRNA_res\n```\n\n    log2 fold change (MLE): treatment treatment vs control \n    Wald test p-value: treatment treatment vs control \n    DataFrame with 37 rows and 6 columns\n                     baseMean log2FoldChange     lfcSE       stat      pvalue\n                    <numeric>      <numeric> <numeric>  <numeric>   <numeric>\n    Cluster_1785  6.63895e+02      0.0149611 0.2810643  0.0532301 0.957548604\n    Cluster_2042  1.35312e+05     -0.1901409 0.4840889 -0.3927810 0.694481249\n    Cluster_2646  1.76900e+03      0.0185890 0.0902545  0.2059620 0.836820596\n    Cluster_3720  4.26842e+01      2.0921221 0.5504186  3.8009659 0.000144133\n    Cluster_4396  4.09498e+00      0.0360325 0.5609930  0.0642299 0.948787181\n    ...                   ...            ...       ...        ...         ...\n    Cluster_29018   1661.6392      2.4245029  0.683762   3.545830 0.000391378\n    Cluster_31844   1372.1080     -0.0477386  0.146375  -0.326140 0.744318793\n    Cluster_32917     14.7573      0.2194667  0.377211   0.581814 0.560691835\n    Cluster_32918   1259.4586      0.5004769  0.370048   1.352466 0.176226232\n    Cluster_32919      4.5894      0.2954022  0.619287   0.477004 0.633359369\n                        padj\n                   <numeric>\n    Cluster_1785  0.98414718\n    Cluster_2042  0.94314745\n    Cluster_2646  0.96982079\n    Cluster_3720  0.00482699\n    Cluster_4396  0.98414718\n    ...                  ...\n    Cluster_29018 0.00482699\n    Cluster_31844 0.94964812\n    Cluster_32917 0.94314745\n    Cluster_32918 0.57114000\n    Cluster_32919 0.94314745\n\n``` r\nsummary(miRNA_res)\n```\n\n    out of 37 with nonzero total read count\n    adjusted p-value < 0.05\n    LFC > 0 (up)       : 3, 8.1%\n    LFC < 0 (down)     : 1, 2.7%\n    outliers [1]       : 0, 0%\n    low counts [2]     : 0, 0%\n    (mean count < 4)\n    [1] see 'cooksCutoff' argument of ?results\n    [2] see 'independentFiltering' argument of ?results\n\n``` r\ntable(miRNA_res$padj < fdr)\n```\n\n    FALSE  TRUE \n       33     4 \n\n### 5.3.3 Write DDS results tables to CSVs\n\n``` r\nwrite.csv(miRNA_res, file = paste0(output_dir, \"deseq2\", \".miRNAs\", \".table.csv\"), row.names = TRUE, quote = FALSE)\n\n# Subset based on adjusted p-value\nmiRNA_resSig <- subset(miRNA_res, padj < fdr)\n\nmiRNA_resSig\n```\n\n    log2 fold change (MLE): treatment treatment vs control \n    Wald test p-value: treatment treatment vs control \n    DataFrame with 4 rows and 6 columns\n                    baseMean log2FoldChange     lfcSE      stat      pvalue\n                   <numeric>      <numeric> <numeric> <numeric>   <numeric>\n    Cluster_3720    42.68419        2.09212  0.550419   3.80097 0.000144133\n    Cluster_15325   27.20988        4.27878  1.188934   3.59883 0.000319647\n    Cluster_17619    7.68082       -2.71853  0.785237  -3.46205 0.000536073\n    Cluster_29018 1661.63918        2.42450  0.683762   3.54583 0.000391378\n                        padj\n                   <numeric>\n    Cluster_3720  0.00482699\n    Cluster_15325 0.00482699\n    Cluster_17619 0.00495868\n    Cluster_29018 0.00482699\n\n``` r\nwrite.csv(miRNA_resSig, file = paste0(output_dir, \"deseq2\", \".miRNAs\", \".fdr-\", fdr, \".lfc-\", log2fc, \".table.csv\"), row.names = TRUE, quote = FALSE)\n```\n\n### 5.3.4 Identify Differentially Expressed miRNAs\n\n``` bash\n\n\n# Extract the first column values (excluding the header)\nclusters=$(cut -d',' -f1 \"../output/03.00-sRNAseq-gene-expression-DESeq2/deseq2.miRNAs.fdr-0.05.lfc-0.table.csv\" | tail -n +2)\n\n# Loop through each cluster and search in the Results.txt file\nfor cluster in $clusters; \ndo\n    grep \"$cluster\" \"../output/02.00-ShortStack-31bp-fastp-merged/ShortStack_out/Results.txt\"\ndone \\\n| tee ../output/03.00-sRNAseq-gene-expression-DESeq2/DE-miRNAs.fdr-0.05.lfc-0.tab\n\necho \"\"\necho \"--------------------------------------------------------------\"\necho \"\"\n\nfor cluster in $clusters; \ndo\n    grep \"$cluster\" \"../output/02.00-ShortStack-31bp-fastp-merged/ShortStack_out/Results.txt\" \\\n    | awk '{print $21}'\ndone\n```\n\n    NW_026853363.1:213466-213568    Cluster_3720    NW_026853363.1  213466  213568  103 1906    84  1.0 +   AGAUAUGUUUGAUAUAUUUGGU  864 9   11  129 1048    458 251 22  Y   cte-miR-190;mle-miR-190-5p\n    NW_026858897.1:43133-43248  Cluster_15325   NW_026858897.1  43133   43248   116 1294    54  0.98    +   UGUUCUACGAGCUGUAGCUGU   685 4   34  796 431 29  0   21  Y   NA\n    NW_026859924.1:190953-191067    Cluster_17619   NW_026859924.1  190953  191067  115 852 54  0.012   -   UGUUCUACGAGCUGUAACUGUC  509 4   70  175 593 10  0   22  Y   NA\n    NW_026865271.1:194028-194125    Cluster_29018   NW_026865271.1  194028  194125  98  66793   264 1.0 +   UCACAACCUGCUUGAAUGAGGAC 31912   323 43  462 5039    38213   22713   23  Y   mle-miR-67-3p\n\n    --------------------------------------------------------------\n\n    cte-miR-190;mle-miR-190-5p\n    NA\n    NA\n    mle-miR-67-3p\n\n## 5.4 Variance stabilizing transformations (VST)\n\n- Here we transform counts using a variance stabilizing transformation\n  (VST), since we have many samples.\n\n``` r\nmiRNA_vsd <- varianceStabilizingTransformation(miRNA_dds, blind=FALSE)\n```\n\n## 5.5 Plotting\n\n### 5.5.1 Sample distances\n\n``` r\nmiRNA_sampleDists <- dist(t(assay(miRNA_vsd)))\n\nmiRNA_sampleDistMatrix <- as.matrix( miRNA_sampleDists )\n\nrownames(miRNA_sampleDistMatrix) <- paste( miRNA_vsd$colony.id, miRNA_vsd$time.point, sep = \" - \" )\n\ncolnames(miRNA_sampleDistMatrix) <- NULL\n\ncolors <- colorRampPalette( rev(brewer.pal(9, \"Blues\")) )(255)\n\npheatmap(miRNA_sampleDistMatrix,\n         clustering_distance_rows = miRNA_sampleDists,\n         clustering_distance_cols = miRNA_sampleDists,\n         col = colors)\n```\n\n![](03.00-sRNAseq-gene-expression-DESeq2_files/figure-gfm/miRNA-plot-sample-distances-1.png)<!-- -->\n\n### 5.5.2 PCA\n\nVisualize sample clustering via PCA (after transformation)\n\n``` r\n# PCA with points color coded by time point \nplotPCA(miRNA_vsd, intgroup = c(\"treatment\"))\n```\n\n![](03.00-sRNAseq-gene-expression-DESeq2_files/figure-gfm/miRNA-pca-1.png)<!-- -->\n\n### 5.5.3 Heatmap of 37 ShortStack miRNAs\n\n``` r\nmiRNA_counts <- order(rowMeans(counts(miRNA_dds,normalized=TRUE)),\n                decreasing=TRUE)[1:37]\n\nannotation = colData(miRNA_dds) %>% as.data.frame() %>% select(treatment)\n\npheatmap(assay(miRNA_vsd)[miRNA_counts,], \n         cluster_rows=FALSE, \n         show_rownames=TRUE,\n         cluster_cols=TRUE, \n         annotation_col = annotation)\n```\n\n![](03.00-sRNAseq-gene-expression-DESeq2_files/figure-gfm/miRNA-heatmap-1.png)<!-- -->\n\n# 6 ALL sRNA\n\n## 6.1 Count data munging\n\n### 6.1.1 Fix col names and convert to matrix\n\n``` r\ncoldata <- sample_treatment_df\n\n# Remove excess portions of sample column names to just \"sample###\"\ncolnames(srna_seq_counts_all) <- sub(\"-fastp-adapters-polyG-31bp-merged_condensed\", \"\", colnames(srna_seq_counts_all))\n\n# Keep just the counts and cluster names as matrix\nsrna_seq_counts_matrix <- as.matrix(srna_seq_counts_all %>% select(-Coords, -MIRNA) %>% column_to_rownames(var = \"Name\"))\n\nstr(srna_seq_counts_matrix)\n```\n\n     num [1:33666, 1:20] 39 33 179 34 279 68 28 233 40 0 ...\n     - attr(*, \"dimnames\")=List of 2\n      ..$ : chr [1:33666] \"Cluster_1\" \"Cluster_2\" \"Cluster_3\" \"Cluster_4\" ...\n      ..$ : chr [1:20] \"196\" \"199\" \"211\" \"24\" ...\n\n### 6.1.2 Take only samples present in coldata\n\n``` r\nsRNA_common_cols <- intersect(colnames(srna_seq_counts_matrix),\n                         rownames(sample_treatment_df))\n\nsrna_seq_counts_matrix <- srna_seq_counts_matrix[, sRNA_common_cols]\n\nstr(srna_seq_counts_matrix)\n```\n\n     num [1:33666, 1:20] 39 33 179 34 279 68 28 233 40 0 ...\n     - attr(*, \"dimnames\")=List of 2\n      ..$ : chr [1:33666] \"Cluster_1\" \"Cluster_2\" \"Cluster_3\" \"Cluster_4\" ...\n      ..$ : chr [1:20] \"196\" \"199\" \"211\" \"24\" ...\n\n### 6.1.3 Reorder matrix cols to match coldata\n\n``` r\nsRNA_ord <- match(rownames(sample_treatment_df), colnames(srna_seq_counts_matrix))\n\nsrna_seq_counts_matrix_sorted <- srna_seq_counts_matrix[, sRNA_ord]\n\nstr(srna_seq_counts_matrix_sorted)\n```\n\n     num [1:33666, 1:20] 39 33 179 34 279 68 28 233 40 0 ...\n     - attr(*, \"dimnames\")=List of 2\n      ..$ : chr [1:33666] \"Cluster_1\" \"Cluster_2\" \"Cluster_3\" \"Cluster_4\" ...\n      ..$ : chr [1:20] \"196\" \"199\" \"211\" \"310\" ...\n\n### 6.1.4 Verify rownames match\n\n``` r\nall(rownames(coldata) == colnames(srna_seq_counts_matrix_sorted))\n```\n\n    [1] TRUE\n\n## 6.2 Create DESeq2 data set\n\n### 6.2.1 Initialize DEseq2 data set\n\n``` r\nsRNA_dds <- DESeqDataSetFromMatrix(countData = srna_seq_counts_matrix_sorted,\n                              colData = coldata,\n                              design = ~ treatment)\nsRNA_dds\n```\n\n    class: DESeqDataSet \n    dim: 33666 20 \n    metadata(1): version\n    assays(1): counts\n    rownames(33666): Cluster_1 Cluster_2 ... Cluster_33665 Cluster_33666\n    rowData names(0):\n    colnames(20): 196 199 ... 71 260\n    colData names(1): treatment\n\n### 6.2.2 Add cluster column as “gene” feature\n\n``` r\nsRNA_featureData <- data.frame(gene=rownames(srna_seq_counts_matrix_sorted))\nmcols(sRNA_dds) <- DataFrame(mcols(sRNA_dds), sRNA_featureData)\nmcols(sRNA_dds)\n```\n\n    DataFrame with 33666 rows and 1 column\n                           gene\n                    <character>\n    Cluster_1         Cluster_1\n    Cluster_2         Cluster_2\n    Cluster_3         Cluster_3\n    Cluster_4         Cluster_4\n    Cluster_5         Cluster_5\n    ...                     ...\n    Cluster_33662 Cluster_33662\n    Cluster_33663 Cluster_33663\n    Cluster_33664 Cluster_33664\n    Cluster_33665 Cluster_33665\n    Cluster_33666 Cluster_33666\n\n### 6.2.3 Set factor levels\n\n``` r\nsRNA_dds$treatment <- factor(sRNA_dds$treatment, levels = c(\"control\", \"treatment\"))\n```\n\n## 6.3 DESeq analysis\n\n### 6.3.1 DEseq\n\n``` r\nsRNA_dds <- DESeq(sRNA_dds)\n```\n\n### 6.3.2 DEseq Results\n\n``` r\nsRNA_res <- results(sRNA_dds, alpha = fdr, lfcThreshold = log2fc)\n\nsRNA_res\n```\n\n    log2 fold change (MLE): treatment treatment vs control \n    Wald test p-value: treatment treatment vs control \n    DataFrame with 33666 rows and 6 columns\n                   baseMean log2FoldChange     lfcSE      stat    pvalue      padj\n                  <numeric>      <numeric> <numeric> <numeric> <numeric> <numeric>\n    Cluster_1       45.5523      -1.029009  1.046267 -0.983505  0.325359  0.766886\n    Cluster_2       25.3913      -0.974521  0.887134 -1.098505  0.271984  0.722394\n    Cluster_3      500.2432      -0.223463  0.681362 -0.327966  0.742938  0.949341\n    Cluster_4       37.4950       0.372492  0.875715  0.425357  0.670576  0.929611\n    Cluster_5      262.8973       0.528197  0.582344  0.907018  0.364397  0.791723\n    ...                 ...            ...       ...       ...       ...       ...\n    Cluster_33662   73.5380     -1.0047441  0.551679 -1.821247 0.0685693  0.422218\n    Cluster_33663  102.4384     -0.8580087  0.593642 -1.445329 0.1483654  0.582914\n    Cluster_33664  165.7171     -0.5549368  0.511572 -1.084768 0.2780242  0.728123\n    Cluster_33665   57.5813     -0.0529832  0.505219 -0.104872 0.9164777  0.984630\n    Cluster_33666 2721.9794     -0.7353095  0.548616 -1.340298 0.1801484  0.629508\n\n``` r\nsummary(sRNA_res)\n```\n\n    out of 33654 with nonzero total read count\n    adjusted p-value < 0.05\n    LFC > 0 (up)       : 335, 1%\n    LFC < 0 (down)     : 373, 1.1%\n    outliers [1]       : 0, 0%\n    low counts [2]     : 665, 2%\n    (mean count < 2)\n    [1] see 'cooksCutoff' argument of ?results\n    [2] see 'independentFiltering' argument of ?results\n\n``` r\ntable(sRNA_res$padj < fdr)\n```\n\n    FALSE  TRUE \n    32293   708 \n\n### 6.3.3 Write DDS results tables to CSVs\n\n``` r\nwrite.csv(sRNA_res, file = paste0(output_dir, \"deseq2\", \".sRNAs\", \".table.csv\"), row.names = TRUE, quote = FALSE)\n\n# Subset based on adjusted p-value\nsRNA_resSig <- subset(sRNA_res, padj < fdr)\n\nsRNA_resSig\n```\n\n    log2 fold change (MLE): treatment treatment vs control \n    Wald test p-value: treatment treatment vs control \n    DataFrame with 708 rows and 6 columns\n                    baseMean log2FoldChange     lfcSE      stat      pvalue\n                   <numeric>      <numeric> <numeric> <numeric>   <numeric>\n    Cluster_62      282.1243       -2.31979  0.705223  -3.28945 1.00384e-03\n    Cluster_90       55.2729        3.23430  0.952673   3.39498 6.86343e-04\n    Cluster_137      48.2576       -3.45184  0.869587  -3.96951 7.20196e-05\n    Cluster_139      47.1693       -3.56747  0.880422  -4.05200 5.07822e-05\n    Cluster_140     585.7301       -4.30156  0.957128  -4.49424 6.98204e-06\n    ...                  ...            ...       ...       ...         ...\n    Cluster_33492   83.31701        3.46496  0.799002   4.33661 1.44695e-05\n    Cluster_33496    9.73899       -4.88615  1.469261  -3.32559 8.82330e-04\n    Cluster_33503  633.79425       -6.14324  0.916828  -6.70053 2.07658e-11\n    Cluster_33524    6.02438        6.14925  1.874132   3.28112 1.03396e-03\n    Cluster_33579 1000.14999       -3.54729  0.648113  -5.47326 4.41842e-08\n                         padj\n                    <numeric>\n    Cluster_62     0.04807906\n    Cluster_90     0.03822268\n    Cluster_137    0.01014849\n    Cluster_139    0.00833762\n    Cluster_140    0.00225896\n    ...                   ...\n    Cluster_33492 3.68202e-03\n    Cluster_33496 4.44546e-02\n    Cluster_33503 1.71323e-07\n    Cluster_33524 4.86066e-02\n    Cluster_33579 5.08059e-05\n\n``` r\nwrite.csv(sRNA_resSig, file = paste0(output_dir, \"deseq2\", \".sRNAs\", \".fdr-\", fdr, \".lfc-\", log2fc, \".table.csv\"), row.names = TRUE, quote = FALSE)\n```\n\n### 6.3.4 Identify Differentially Expressed sRNAs\n\n``` bash\n\n\n# Extract the first column values (excluding the header)\nclusters=$(cut -d',' -f1 \"../output/03.00-sRNAseq-gene-expression-DESeq2/deseq2.sRNAs.fdr-0.05.lfc-0.table.csv\" | tail -n +2)\n\n# Loop through each cluster and search in the Results.txt file\nfor cluster in $clusters; \ndo\n    grep \"$cluster\" \"../output/02.00-ShortStack-31bp-fastp-merged/ShortStack_out/Results.txt\"\ndone > ../output/03.00-sRNAseq-gene-expression-DESeq2/DE-sRNAs.fdr-0.05.lfc-0.tab\n```\n\n## 6.4 Variance stabilizing transformations (VST)\n\n- Here we transform counts using a variance stabilizing transformation\n  (VST), since we have many samples.\n\n``` r\nsRNA_vsd <- varianceStabilizingTransformation(sRNA_dds, blind=FALSE)\n```\n\n## 6.5 Plotting\n\n### 6.5.1 Sample distances\n\n``` r\nsRNA_sampleDists <- dist(t(assay(sRNA_vsd)))\n\nsRNA_sampleDistMatrix <- as.matrix( sRNA_sampleDists )\n\nrownames(sRNA_sampleDistMatrix) <- paste( sRNA_vsd$colony.id, sRNA_vsd$time.point, sep = \" - \" )\n\ncolnames(sRNA_sampleDistMatrix) <- NULL\n\ncolors <- colorRampPalette( rev(brewer.pal(9, \"Blues\")) )(255)\n\npheatmap(sRNA_sampleDistMatrix,\n         clustering_distance_rows = sRNA_sampleDists,\n         clustering_distance_cols = sRNA_sampleDists,\n         col = colors)\n```\n\n![](03.00-sRNAseq-gene-expression-DESeq2_files/figure-gfm/sRNA-plot-sample-distances-1.png)<!-- -->\n\n### 6.5.2 PCA\n\nVisualize sample clustering via PCA (after transformation)\n\n``` r\n# PCA with points color coded by time point \nplotPCA(sRNA_vsd, intgroup = c(\"treatment\"))\n```\n\n![](03.00-sRNAseq-gene-expression-DESeq2_files/figure-gfm/sRNA-pca-1.png)<!-- -->\n\n### 6.5.3 Heatmap of Top 50 sRNAs\n\n``` r\nsRNA_counts_top50 <- order(rowMeans(counts(sRNA_dds,normalized=TRUE)),\n                decreasing=TRUE)[1:50]\n\nannotation = colData(sRNA_dds) %>% as.data.frame() %>% select(treatment)\n\npheatmap(assay(sRNA_vsd)[sRNA_counts_top50,], \n         cluster_rows=FALSE, \n         show_rownames=FALSE,\n         cluster_cols=TRUE, \n         annotation_col = annotation)\n```\n\n![](03.00-sRNAseq-gene-expression-DESeq2_files/figure-gfm/sRNA-heatmap-1.png)<!-- -->\n\n# 7 REFERENCES\n\n<div id=\"refs\" class=\"references csl-bib-body hanging-indent\">\n\n<div id=\"ref-love2014\" class=\"csl-entry\">\n\nLove, Michael I, Wolfgang Huber, and Simon Anders. 2014. “Moderated\nEstimation of Fold Change and Dispersion for RNA-Seq Data with DESeq2.”\n*Genome Biology* 15 (12). <https://doi.org/10.1186/s13059-014-0550-8>.\n\n</div>\n\n</div>",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}