{"title":"GO to GOslim - C.bairdi Enriched GO Terms from 20200422 DEGs","markdown":{"yaml":{"author":"Sam White","toc-title":"Contents","toc-depth":5,"toc-location":"left","layout":"post","title":"GO to GOslim - C.bairdi Enriched GO Terms from 20200422 DEGs","date":"2020-04-27 12:04","tags":["Tanner crab","GO","GOslim","gene ontology","R","Chionoecetes bairdi"],"categories":["2020","Miscellaneous"]},"headingText":"Scipt to map C.bairdi DEG enriched GO terms to GOslims","containsRefs":false,"markdown":"\n[After running pairwise comparisons and identify differentially expressed genes (DEGs) on 20200422](https://robertslab.github.io/sams-notebook/posts/2020/2020-04-22-Gene-Expression---C.bairdi-Pairwise-DEG-Comparisons-with-2019-RNAseq-using-Trinity-Salmon-EdgeR-on-Mox/) and finding enriched gene ontology terms, I decided to map the GO terms to Biological Process GOslims. Additionally, I decided to try another level of comparison (I'm not sure how valid it is), whereby I will count the number of GO terms assigned to each GOslim and then calculate the percentage of GOterms that get assigned to each of the GOslim categories. The idea being that it might help identify Biological Processes that are \"favored\" in a given set of DEGs. I decided to set up \"fancy\" pyramid plots to view a given set of GO-GOslims for each DEG comparison.\n\nAll work was done in R. The initial counting/percentage calculations were done with the following R script (note: all of the followin R code are part of an R Project - link is in the RESULTS section of notebook). The R script uses a \"flattened\" set of the enriched GO terms identified by Trinity/GOseq, where flattened means one GO term per row. So, a gene may be represented multiple times, in multiple rows if there were multiple GO terms assigned to it by Trinity/GOseq.\n\nThe script then relies on the [GSEABase package (Bioconductor)](https://bioconductor.org/packages/release/bioc/html/GSEABase.html) and the GO Consortium's \"Generic GO subset\":\n\n- [goslim_generic.obo](http://current.geneontology.org/ontology/subsets/goslim_generic.obo)\n\n\nAfter that, I plotted the outputs.\n\nGO to GOslim R script:\n\n- [GO_to_GOslim.R](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/scripts/GO_to_GOslim.R)\n\n```R\nlibrary(GSEABase)\nlibrary(tidyverse)\n\n#########################################################################\n# and identify the GO terms contributing to each GOslim\n#########################################################################\n\n### Download files and specify destination directory\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/D9-D12/edgeR.169728.dir/salmon.gene.counts.matrix.D12_vs_D9.edgeR.DE_results.P0.05_C1.D12-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/D9-D12/salmon.gene.counts.matrix.D12_vs_D9.edgeR.DE_results.P0.05_C1.D12-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/D9-D12/edgeR.169728.dir/salmon.gene.counts.matrix.D12_vs_D9.edgeR.DE_results.P0.05_C1.D9-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/D9-D12/salmon.gene.counts.matrix.D12_vs_D9.edgeR.DE_results.P0.05_C1.D9-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/D9-D26/edgeR.200352.dir/salmon.gene.counts.matrix.D26_vs_D9.edgeR.DE_results.P0.05_C1.D9-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/D9-D26/salmon.gene.counts.matrix.D26_vs_D9.edgeR.DE_results.P0.05_C1.D9-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/D9-D26/edgeR.200352.dir/salmon.gene.counts.matrix.D26_vs_D9.edgeR.DE_results.P0.05_C1.D26-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/D9-D26/salmon.gene.counts.matrix.D26_vs_D9.edgeR.DE_results.P0.05_C1.D26-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/D12-D26/edgeR.230922.dir/salmon.gene.counts.matrix.D12_vs_D26.edgeR.DE_results.P0.05_C1.D26-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/D12-D26/salmon.gene.counts.matrix.D12_vs_D26.edgeR.DE_results.P0.05_C1.D26-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/ambient-cold/edgeR.267393.dir/salmon.gene.counts.matrix.ambient_vs_cold.edgeR.DE_results.P0.05_C1.ambient-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/ambient-cold/salmon.gene.counts.matrix.ambient_vs_cold.edgeR.DE_results.P0.05_C1.ambient-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/ambient-cold/edgeR.267393.dir/salmon.gene.counts.matrix.ambient_vs_cold.edgeR.DE_results.P0.05_C1.cold-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/ambient-cold/salmon.gene.counts.matrix.ambient_vs_cold.edgeR.DE_results.P0.05_C1.cold-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/ambient-warm/edgeR.297991.dir/salmon.gene.counts.matrix.ambient_vs_warm.edgeR.DE_results.P0.05_C1.warm-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/ambient-warm/salmon.gene.counts.matrix.ambient_vs_warm.edgeR.DE_results.P0.05_C1.warm-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/ambient-warm/edgeR.297991.dir/salmon.gene.counts.matrix.ambient_vs_warm.edgeR.DE_results.P0.05_C1.ambient-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/ambient-warm/salmon.gene.counts.matrix.ambient_vs_warm.edgeR.DE_results.P0.05_C1.ambient-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/cold-warm/edgeR.328585.dir/salmon.gene.counts.matrix.cold_vs_warm.edgeR.DE_results.P0.05_C1.warm-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/cold-warm/salmon.gene.counts.matrix.cold_vs_warm.edgeR.DE_results.P0.05_C1.warm-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/cold-warm/edgeR.328585.dir/salmon.gene.counts.matrix.cold_vs_warm.edgeR.DE_results.P0.05_C1.cold-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/cold-warm/salmon.gene.counts.matrix.cold_vs_warm.edgeR.DE_results.P0.05_C1.cold-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/infected-uninfected/edgeR.132470.dir/salmon.gene.counts.matrix.infected_vs_uninfected.edgeR.DE_results.P0.05_C1.infected-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/infected-uninfected/salmon.gene.counts.matrix.infected_vs_uninfected.edgeR.DE_results.P0.05_C1.infected-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/infected-uninfected/edgeR.132470.dir/salmon.gene.counts.matrix.infected_vs_uninfected.edgeR.DE_results.P0.05_C1.uninfected-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/infected-uninfected/salmon.gene.counts.matrix.infected_vs_uninfected.edgeR.DE_results.P0.05_C1.uninfected-UP.subset.GOseq.enriched.flattened\")\n\n\n### Set false discovery rate (FDR) filter, if desired\nfdr <- as.character(\"1.0\")\n\n### Create list of files\ngoseq_files <- list.files(path = \"./data\",\n                          pattern = \"\\\\.GOseq.[de]\",\n                          recursive = TRUE,\n                          full.names = TRUE)\n\n### Set output filename suffix\noutput_suffix=(\"GOslims.csv\")\n\n### Strip path from goseq files\ngoseq_filename <- basename(goseq_files)\n\n### Vector of GOslim ontologies (e.g. Biological Process = BP, Molecular Function = MF, Cellular Component = CC)\nontologies <- c(\"BP\", \"CC\", \"MF\")\n\nfor (slim_ontology in ontologies) {\n\n  ### Set GOOFFSPRING database, based on ontology group set above\n  go_offspring <- paste(\"GO\", slim_ontology, \"OFFSPRING\", sep = \"\")\n\n  for (item in goseq_files) {\n\n    ## Get max number of fields\n    # Needed to handle reading in file with different number of columns in each row\n    # as there may be multiple\n    max_fields <- max(count.fields(item, sep = \"\\t\"), na.rm = TRUE)\n\n    ## Read in tab-delimited GOseq file\n    # Use \"max_fields\" to populate all columns with a sequentially numbered header\n    go_seqs <- read.delim(item,\n                          col.names = paste0(\"V\",seq_len(max_fields)))\n\n    ## Filter enriched GOterms with false discovery rate\n    goseqs_fdr <- filter(go_seqs, V8 <= as.numeric(fdr))\n\n    ## Grab just the individual GO terms from the \"category\" column)\n    goterms <- as.character(goseqs_fdr$V1)\n\n    ### Use GSEA to map GO terms to GOslims\n\n    ## Store goterms as GSEA object\n    myCollection <- GOCollection(goterms)\n\n    ## Use generic GOslim file to create a GOslim collection\n\n    # I downloaded goslim_generic.obo from http://geneontology.org/docs/go-subset-guide\n    # then i moved it to the R library for GSEABase in the extdata folder\n    # in addition to using the command here - I think they're both required.\n    slim <- getOBOCollection(\"./data/goslim_generic.obo\")\n\n    ## Map GO terms to GOslims and select Biological Processes group\n    slimsdf <- goSlim(myCollection, slim, slim_ontology)\n\n    ## Need to know the 'offspring' of each term in the ontology, and this is given by the data in:\n    # GO.db::getFromNamespace(go_offspring, \"GO.db\")\n\n    ## Create function to parse out GO terms assigned to each GOslim\n    ## Courtesy Bioconductor Support: https://support.bioconductor.org/p/128407\n    mappedIds <-\n      function(df, collection, OFFSPRING)\n      {\n        map <- as.list(OFFSPRING[rownames(df)])\n        mapped <- lapply(map, intersect, ids(collection))\n        df[[\"go_terms\"]] <- vapply(unname(mapped), paste, collapse = \";\", character(1L))\n        df\n      }\n\n    ## Run the function\n    slimsdf <- mappedIds(slimsdf, myCollection, getFromNamespace(go_offspring, \"GO.db\"))\n\n    ## Provide column name for first column\n    slimsdf <- cbind(GOslim = rownames(slimsdf), slimsdf)\n    rownames(slimsdf) <- NULL\n\n    ### Prep output file naming structure\n\n    ## Split filenames on periods\n    ## Creates a list\n    split_filename <- strsplit(item, \".\", fixed = TRUE)\n\n    ## Split filename on directories\n    ## Creates a list\n    split_dirs <- strsplit(item, \"/\", fixed = TRUE)\n\n    ## Slice split_filename list from position 9 to the last position of the list\n    ## Paste these together using a period\n    goseq_filename_split <-paste(split_filename[[1]][9:lengths(split_filename)], collapse = \".\")\n\n    ## Slice split_dirs list at position\n\n    ## Paste elements together to form output filename\n    fdr_file_out <- paste(\"FDR\", fdr, sep = \"_\")\n    outfilename <- paste(goseq_filename_split, fdr_file_out, slim_ontology ,output_suffix, collapse = \".\", sep = \".\")\n\n    ## Set output file destination and name\n    ## Adds proper subdirectory from split_dirs list\n    outfile_dest <- file.path(\"./analyses\", split_dirs[[1]][3], outfilename)\n\n    ## Write output file\n    write.csv(slimsdf, file = outfile_dest, quote = FALSE, row.names = FALSE)\n\n\n  }\n}\n```\n\nSince I got \"lazy\" and didn't want to try to figure out how to properly loop through all of the output files from the above script, I just made individual scripts to plot each set of comparison GO terms percentages assigned to GOslims. Here's an example:\n\n- [infected-uninfected_GOslim_pyramid_plotting.R](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/scripts/infected-uninfected_GOslim_pyramid_plotting.R)\n\n```R\n# Script to generate a \"pyramid\" plot\n# comparing the percentages of enriched GO terms assinged\n# to each category of Biological Process GOslims\n\nlibrary(dplyr)\nlibrary(ggplot2)\n\n\n#####################################################\n# Set the following variables for the appropriate comparisons/files\n#####################################################\n# Comparison\ncomparison <- \"infected-uninfected\"\n\n# Treatments\ntreatment_01 <- \"infected\"\ntreatment_02 <- \"uninfected\"\n\n# Read in first comparsion files\ndf1 <- read.csv(\"analyses/infected-uninfected/P0.05_C1.infected-UP.subset.GOseq.enriched.flattened.FDR_1.0.BP.GOslims.csv\")\n\n# Read in second comparison file\ndf2 <- read.csv(\"analyses/infected-uninfected/P0.05_C1.uninfected-UP.subset.GOseq.enriched.flattened.FDR_1.0.BP.GOslims.csv\")\n\n\n######################################################\n# CHANGES BELOW HERE ARE PROBABLY NOT NECESSARY\n######################################################\n\n# GOslim categories\nontologies <- c(\"BP\", \"CC\", \"MF\")\n\n# Remove generic \"biological_process\" category\ndf1 <- df1[df1$GOslim != \"GO:0008150\",]\ndf2 <- df2[df2$GOslim != \"GO:0008150\",]\n\n# Remove generic \"cellular_component\"  category\ndf1 <- df1[df1$GOslim != \"GO:0005575\",]\ndf2 <- df2[df2$GOslim != \"GO:0005575\",]\n\n\n# Remove generic \"molecular_function\"  category\ndf1 <- df1[df1$GOslim != \"GO:0003674\",]\ndf2 <- df2[df2$GOslim != \"GO:0003674\",]\n\n# Select columns\ndf1 <- df1 %>% select(Term, Percent)\ndf2 <- df2 %>% select(Term, Percent)\n\n# Create treatment column and assign term to all rows\ndf1$treatment <- treatment_01\ndf2$treatment <- treatment_02\n\n# Concatenate dataframes\ndf3 <- rbind(df1, df2)\n\n# Filename for plot\npyramid <- paste(comparison, \"GOslims\", \"BP\", \"png\", sep = \".\")\npyramid_path <- paste(comparison, pyramid, sep = \"/\")\npyramid_dest <- file.path(\"./analyses\", pyramid_path)\n\n# \"Open\" PNG file for saving subsequent plot\npng(pyramid_dest, width = 600, height = 1200, units = \"px\", pointsize = 12)\n\n# Create \"pyramid\" plot\nggplot(df3, aes(x = Term, fill = treatment,\n                y = ifelse(test = treatment == treatment_01,\n                           yes = -Percent,\n                           no = Percent))) +\n  geom_bar(stat = \"identity\") +\n  scale_y_continuous(labels = abs, limits = max(df3$Percent) * c(-1,1)) +\n  labs(title = \"Percentages of GO terms assigned to BP GOslims\", x = \"GOslim\", y = \"Percent GO terms in GOslim\") +\n  scale_x_discrete(expand = c(-1,0)) +\n  coord_flip()\n\n# Close PNG file\ndev.off()\n```\n\n---\n\n# RESULTS\n\nOutput folder (GitHub; R Project):\n\n- [20200427_cbai_deg_go-goslims](https://github.com/RobertsLab/code/tree/master/r_projects/sam/20200427_cbai_deg_go-goslims)\n\nImages of each of the plots are below. Larger versions of the images can be viewed by clicking on the image. All images are 1200x600 pixels, so should be a reasonable size for viewing.\n\nAlso, it should be noted that the GOslim term \"biological_process\" was omitted from the plotting. This GOslim category is a \"catchall\" for any GO terms that do not fall into a GOslim category. As such, \"biological_process\" almost always makes up the bulk of the GOslim and this effectively compresses the plots, making it difficult to see any differences between the remaining GOslim categories. Knowing this explains why the percentages in each comparison never add up to 100%!\n\n#### D9-D12\n\n![D9 vs D12 GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/D9-D12/D9-D12.GOslims.BP.png?raw=true)\n\n---\n\n#### D9-D26\n\n![D9 vs D26 GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/D9-D26/D9-D26.GOslims.BP.png?raw=true)\n\n---\n\n#### D12-D26\n\n![D12 vs D26 GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/D12-D26/D12-D26.GOslims.BP.png?raw=true)\n\n---\n\n#### ambient-cold\n\n![ambient vs vold GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/ambient-cold/ambient-cold.GOslims.BP.png?raw=true)\n\n---\n\n#### ambient-warm\n\n![ambient vs warm GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/ambient-warm/ambient-warm.GOslims.BP.png?raw=true)\n\n---\n\n#### cold-warm\n\n![cold vs warm GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/cold-warm/cold-warm.GOslims.BP.png?raw=true)\n\n---\n\n#### infected-uninfected\n\n![infected vs uninfected GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/infected-uninfected/infected-uninfected.GOslims.BP.png?raw=true)\n","srcMarkdownNoYaml":"\n[After running pairwise comparisons and identify differentially expressed genes (DEGs) on 20200422](https://robertslab.github.io/sams-notebook/posts/2020/2020-04-22-Gene-Expression---C.bairdi-Pairwise-DEG-Comparisons-with-2019-RNAseq-using-Trinity-Salmon-EdgeR-on-Mox/) and finding enriched gene ontology terms, I decided to map the GO terms to Biological Process GOslims. Additionally, I decided to try another level of comparison (I'm not sure how valid it is), whereby I will count the number of GO terms assigned to each GOslim and then calculate the percentage of GOterms that get assigned to each of the GOslim categories. The idea being that it might help identify Biological Processes that are \"favored\" in a given set of DEGs. I decided to set up \"fancy\" pyramid plots to view a given set of GO-GOslims for each DEG comparison.\n\nAll work was done in R. The initial counting/percentage calculations were done with the following R script (note: all of the followin R code are part of an R Project - link is in the RESULTS section of notebook). The R script uses a \"flattened\" set of the enriched GO terms identified by Trinity/GOseq, where flattened means one GO term per row. So, a gene may be represented multiple times, in multiple rows if there were multiple GO terms assigned to it by Trinity/GOseq.\n\nThe script then relies on the [GSEABase package (Bioconductor)](https://bioconductor.org/packages/release/bioc/html/GSEABase.html) and the GO Consortium's \"Generic GO subset\":\n\n- [goslim_generic.obo](http://current.geneontology.org/ontology/subsets/goslim_generic.obo)\n\n\nAfter that, I plotted the outputs.\n\nGO to GOslim R script:\n\n- [GO_to_GOslim.R](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/scripts/GO_to_GOslim.R)\n\n```R\nlibrary(GSEABase)\nlibrary(tidyverse)\n\n#########################################################################\n# Scipt to map C.bairdi DEG enriched GO terms to GOslims\n# and identify the GO terms contributing to each GOslim\n#########################################################################\n\n### Download files and specify destination directory\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/D9-D12/edgeR.169728.dir/salmon.gene.counts.matrix.D12_vs_D9.edgeR.DE_results.P0.05_C1.D12-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/D9-D12/salmon.gene.counts.matrix.D12_vs_D9.edgeR.DE_results.P0.05_C1.D12-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/D9-D12/edgeR.169728.dir/salmon.gene.counts.matrix.D12_vs_D9.edgeR.DE_results.P0.05_C1.D9-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/D9-D12/salmon.gene.counts.matrix.D12_vs_D9.edgeR.DE_results.P0.05_C1.D9-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/D9-D26/edgeR.200352.dir/salmon.gene.counts.matrix.D26_vs_D9.edgeR.DE_results.P0.05_C1.D9-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/D9-D26/salmon.gene.counts.matrix.D26_vs_D9.edgeR.DE_results.P0.05_C1.D9-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/D9-D26/edgeR.200352.dir/salmon.gene.counts.matrix.D26_vs_D9.edgeR.DE_results.P0.05_C1.D26-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/D9-D26/salmon.gene.counts.matrix.D26_vs_D9.edgeR.DE_results.P0.05_C1.D26-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/D12-D26/edgeR.230922.dir/salmon.gene.counts.matrix.D12_vs_D26.edgeR.DE_results.P0.05_C1.D26-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/D12-D26/salmon.gene.counts.matrix.D12_vs_D26.edgeR.DE_results.P0.05_C1.D26-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/ambient-cold/edgeR.267393.dir/salmon.gene.counts.matrix.ambient_vs_cold.edgeR.DE_results.P0.05_C1.ambient-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/ambient-cold/salmon.gene.counts.matrix.ambient_vs_cold.edgeR.DE_results.P0.05_C1.ambient-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/ambient-cold/edgeR.267393.dir/salmon.gene.counts.matrix.ambient_vs_cold.edgeR.DE_results.P0.05_C1.cold-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/ambient-cold/salmon.gene.counts.matrix.ambient_vs_cold.edgeR.DE_results.P0.05_C1.cold-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/ambient-warm/edgeR.297991.dir/salmon.gene.counts.matrix.ambient_vs_warm.edgeR.DE_results.P0.05_C1.warm-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/ambient-warm/salmon.gene.counts.matrix.ambient_vs_warm.edgeR.DE_results.P0.05_C1.warm-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/ambient-warm/edgeR.297991.dir/salmon.gene.counts.matrix.ambient_vs_warm.edgeR.DE_results.P0.05_C1.ambient-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/ambient-warm/salmon.gene.counts.matrix.ambient_vs_warm.edgeR.DE_results.P0.05_C1.ambient-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/cold-warm/edgeR.328585.dir/salmon.gene.counts.matrix.cold_vs_warm.edgeR.DE_results.P0.05_C1.warm-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/cold-warm/salmon.gene.counts.matrix.cold_vs_warm.edgeR.DE_results.P0.05_C1.warm-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/cold-warm/edgeR.328585.dir/salmon.gene.counts.matrix.cold_vs_warm.edgeR.DE_results.P0.05_C1.cold-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/cold-warm/salmon.gene.counts.matrix.cold_vs_warm.edgeR.DE_results.P0.05_C1.cold-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/infected-uninfected/edgeR.132470.dir/salmon.gene.counts.matrix.infected_vs_uninfected.edgeR.DE_results.P0.05_C1.infected-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/infected-uninfected/salmon.gene.counts.matrix.infected_vs_uninfected.edgeR.DE_results.P0.05_C1.infected-UP.subset.GOseq.enriched.flattened\")\n\ndownload.file(url = \"https://gannet.fish.washington.edu/Atumefaciens/20200422_cbai_DEG_basic_comparisons/infected-uninfected/edgeR.132470.dir/salmon.gene.counts.matrix.infected_vs_uninfected.edgeR.DE_results.P0.05_C1.uninfected-UP.subset.GOseq.enriched.flattened\",\n              destfile = \"./data/infected-uninfected/salmon.gene.counts.matrix.infected_vs_uninfected.edgeR.DE_results.P0.05_C1.uninfected-UP.subset.GOseq.enriched.flattened\")\n\n\n### Set false discovery rate (FDR) filter, if desired\nfdr <- as.character(\"1.0\")\n\n### Create list of files\ngoseq_files <- list.files(path = \"./data\",\n                          pattern = \"\\\\.GOseq.[de]\",\n                          recursive = TRUE,\n                          full.names = TRUE)\n\n### Set output filename suffix\noutput_suffix=(\"GOslims.csv\")\n\n### Strip path from goseq files\ngoseq_filename <- basename(goseq_files)\n\n### Vector of GOslim ontologies (e.g. Biological Process = BP, Molecular Function = MF, Cellular Component = CC)\nontologies <- c(\"BP\", \"CC\", \"MF\")\n\nfor (slim_ontology in ontologies) {\n\n  ### Set GOOFFSPRING database, based on ontology group set above\n  go_offspring <- paste(\"GO\", slim_ontology, \"OFFSPRING\", sep = \"\")\n\n  for (item in goseq_files) {\n\n    ## Get max number of fields\n    # Needed to handle reading in file with different number of columns in each row\n    # as there may be multiple\n    max_fields <- max(count.fields(item, sep = \"\\t\"), na.rm = TRUE)\n\n    ## Read in tab-delimited GOseq file\n    # Use \"max_fields\" to populate all columns with a sequentially numbered header\n    go_seqs <- read.delim(item,\n                          col.names = paste0(\"V\",seq_len(max_fields)))\n\n    ## Filter enriched GOterms with false discovery rate\n    goseqs_fdr <- filter(go_seqs, V8 <= as.numeric(fdr))\n\n    ## Grab just the individual GO terms from the \"category\" column)\n    goterms <- as.character(goseqs_fdr$V1)\n\n    ### Use GSEA to map GO terms to GOslims\n\n    ## Store goterms as GSEA object\n    myCollection <- GOCollection(goterms)\n\n    ## Use generic GOslim file to create a GOslim collection\n\n    # I downloaded goslim_generic.obo from http://geneontology.org/docs/go-subset-guide\n    # then i moved it to the R library for GSEABase in the extdata folder\n    # in addition to using the command here - I think they're both required.\n    slim <- getOBOCollection(\"./data/goslim_generic.obo\")\n\n    ## Map GO terms to GOslims and select Biological Processes group\n    slimsdf <- goSlim(myCollection, slim, slim_ontology)\n\n    ## Need to know the 'offspring' of each term in the ontology, and this is given by the data in:\n    # GO.db::getFromNamespace(go_offspring, \"GO.db\")\n\n    ## Create function to parse out GO terms assigned to each GOslim\n    ## Courtesy Bioconductor Support: https://support.bioconductor.org/p/128407\n    mappedIds <-\n      function(df, collection, OFFSPRING)\n      {\n        map <- as.list(OFFSPRING[rownames(df)])\n        mapped <- lapply(map, intersect, ids(collection))\n        df[[\"go_terms\"]] <- vapply(unname(mapped), paste, collapse = \";\", character(1L))\n        df\n      }\n\n    ## Run the function\n    slimsdf <- mappedIds(slimsdf, myCollection, getFromNamespace(go_offspring, \"GO.db\"))\n\n    ## Provide column name for first column\n    slimsdf <- cbind(GOslim = rownames(slimsdf), slimsdf)\n    rownames(slimsdf) <- NULL\n\n    ### Prep output file naming structure\n\n    ## Split filenames on periods\n    ## Creates a list\n    split_filename <- strsplit(item, \".\", fixed = TRUE)\n\n    ## Split filename on directories\n    ## Creates a list\n    split_dirs <- strsplit(item, \"/\", fixed = TRUE)\n\n    ## Slice split_filename list from position 9 to the last position of the list\n    ## Paste these together using a period\n    goseq_filename_split <-paste(split_filename[[1]][9:lengths(split_filename)], collapse = \".\")\n\n    ## Slice split_dirs list at position\n\n    ## Paste elements together to form output filename\n    fdr_file_out <- paste(\"FDR\", fdr, sep = \"_\")\n    outfilename <- paste(goseq_filename_split, fdr_file_out, slim_ontology ,output_suffix, collapse = \".\", sep = \".\")\n\n    ## Set output file destination and name\n    ## Adds proper subdirectory from split_dirs list\n    outfile_dest <- file.path(\"./analyses\", split_dirs[[1]][3], outfilename)\n\n    ## Write output file\n    write.csv(slimsdf, file = outfile_dest, quote = FALSE, row.names = FALSE)\n\n\n  }\n}\n```\n\nSince I got \"lazy\" and didn't want to try to figure out how to properly loop through all of the output files from the above script, I just made individual scripts to plot each set of comparison GO terms percentages assigned to GOslims. Here's an example:\n\n- [infected-uninfected_GOslim_pyramid_plotting.R](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/scripts/infected-uninfected_GOslim_pyramid_plotting.R)\n\n```R\n# Script to generate a \"pyramid\" plot\n# comparing the percentages of enriched GO terms assinged\n# to each category of Biological Process GOslims\n\nlibrary(dplyr)\nlibrary(ggplot2)\n\n\n#####################################################\n# Set the following variables for the appropriate comparisons/files\n#####################################################\n# Comparison\ncomparison <- \"infected-uninfected\"\n\n# Treatments\ntreatment_01 <- \"infected\"\ntreatment_02 <- \"uninfected\"\n\n# Read in first comparsion files\ndf1 <- read.csv(\"analyses/infected-uninfected/P0.05_C1.infected-UP.subset.GOseq.enriched.flattened.FDR_1.0.BP.GOslims.csv\")\n\n# Read in second comparison file\ndf2 <- read.csv(\"analyses/infected-uninfected/P0.05_C1.uninfected-UP.subset.GOseq.enriched.flattened.FDR_1.0.BP.GOslims.csv\")\n\n\n######################################################\n# CHANGES BELOW HERE ARE PROBABLY NOT NECESSARY\n######################################################\n\n# GOslim categories\nontologies <- c(\"BP\", \"CC\", \"MF\")\n\n# Remove generic \"biological_process\" category\ndf1 <- df1[df1$GOslim != \"GO:0008150\",]\ndf2 <- df2[df2$GOslim != \"GO:0008150\",]\n\n# Remove generic \"cellular_component\"  category\ndf1 <- df1[df1$GOslim != \"GO:0005575\",]\ndf2 <- df2[df2$GOslim != \"GO:0005575\",]\n\n\n# Remove generic \"molecular_function\"  category\ndf1 <- df1[df1$GOslim != \"GO:0003674\",]\ndf2 <- df2[df2$GOslim != \"GO:0003674\",]\n\n# Select columns\ndf1 <- df1 %>% select(Term, Percent)\ndf2 <- df2 %>% select(Term, Percent)\n\n# Create treatment column and assign term to all rows\ndf1$treatment <- treatment_01\ndf2$treatment <- treatment_02\n\n# Concatenate dataframes\ndf3 <- rbind(df1, df2)\n\n# Filename for plot\npyramid <- paste(comparison, \"GOslims\", \"BP\", \"png\", sep = \".\")\npyramid_path <- paste(comparison, pyramid, sep = \"/\")\npyramid_dest <- file.path(\"./analyses\", pyramid_path)\n\n# \"Open\" PNG file for saving subsequent plot\npng(pyramid_dest, width = 600, height = 1200, units = \"px\", pointsize = 12)\n\n# Create \"pyramid\" plot\nggplot(df3, aes(x = Term, fill = treatment,\n                y = ifelse(test = treatment == treatment_01,\n                           yes = -Percent,\n                           no = Percent))) +\n  geom_bar(stat = \"identity\") +\n  scale_y_continuous(labels = abs, limits = max(df3$Percent) * c(-1,1)) +\n  labs(title = \"Percentages of GO terms assigned to BP GOslims\", x = \"GOslim\", y = \"Percent GO terms in GOslim\") +\n  scale_x_discrete(expand = c(-1,0)) +\n  coord_flip()\n\n# Close PNG file\ndev.off()\n```\n\n---\n\n# RESULTS\n\nOutput folder (GitHub; R Project):\n\n- [20200427_cbai_deg_go-goslims](https://github.com/RobertsLab/code/tree/master/r_projects/sam/20200427_cbai_deg_go-goslims)\n\nImages of each of the plots are below. Larger versions of the images can be viewed by clicking on the image. All images are 1200x600 pixels, so should be a reasonable size for viewing.\n\nAlso, it should be noted that the GOslim term \"biological_process\" was omitted from the plotting. This GOslim category is a \"catchall\" for any GO terms that do not fall into a GOslim category. As such, \"biological_process\" almost always makes up the bulk of the GOslim and this effectively compresses the plots, making it difficult to see any differences between the remaining GOslim categories. Knowing this explains why the percentages in each comparison never add up to 100%!\n\n#### D9-D12\n\n![D9 vs D12 GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/D9-D12/D9-D12.GOslims.BP.png?raw=true)\n\n---\n\n#### D9-D26\n\n![D9 vs D26 GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/D9-D26/D9-D26.GOslims.BP.png?raw=true)\n\n---\n\n#### D12-D26\n\n![D12 vs D26 GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/D12-D26/D12-D26.GOslims.BP.png?raw=true)\n\n---\n\n#### ambient-cold\n\n![ambient vs vold GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/ambient-cold/ambient-cold.GOslims.BP.png?raw=true)\n\n---\n\n#### ambient-warm\n\n![ambient vs warm GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/ambient-warm/ambient-warm.GOslims.BP.png?raw=true)\n\n---\n\n#### cold-warm\n\n![cold vs warm GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/cold-warm/cold-warm.GOslims.BP.png?raw=true)\n\n---\n\n#### infected-uninfected\n\n![infected vs uninfected GO-GOslim pyramid plot](https://github.com/RobertsLab/code/blob/master/r_projects/sam/20200427_cbai_deg_go-goslims/analyses/infected-uninfected/infected-uninfected.GOslims.BP.png?raw=true)\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../../styles.css"],"toc":true,"toc-depth":5,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.42","editor":"source","theme":"darkly","page-layout":"full","code-background":true,"code-copy":true,"title-block-banner":true,"author":"Sam White","toc-title":"Contents","toc-location":"left","layout":"post","title":"GO to GOslim - C.bairdi Enriched GO Terms from 20200422 DEGs","date":"2020-04-27 12:04","tags":["Tanner crab","GO","GOslim","gene ontology","R","Chionoecetes bairdi"],"categories":["2020","Miscellaneous"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}