{"title":"Software Install - MSMTP For Email Notices of Bash Job Completion on Emu (Ubuntu)","markdown":{"yaml":{"author":"Sam White","toc-title":"Contents","toc-depth":5,"toc-location":"left","date":"2017-12-13 21:47:05+00:00","layout":"post","slug":"software-install-msmtp-for-email-notices-of-bash-job-completion-on-emu-ubuntu","title":"Software Install - MSMTP For Email Notices of Bash Job Completion on Emu (Ubuntu)","categories":["2017","Miscellaneous"],"tags":["email","emu","encryption","gpg","msmtp","password","ubuntu"]},"headingText":"Step 1. Installed a mail server:","containsRefs":false,"markdown":"\n\n[After I finally resolved the installation of PB Jelly on Emu](https://robertslab.github.io/sams-notebook/posts/2017/2017-11-30-troubleshooting-pb-jelly-install-on-emu-continued/) (running Ubuntu 16.04), I've had a PB Jelly assembly running for the past two weeks! I've gotten tired of checking on its status (i.e. is it still running?) every day, so I dove in and figured out how to set up Emu to email me when the job is complete!\n\nTo get this going, I mainly followed this [msmtp ArchWiki guide.](https://wiki.archlinux.org/index.php/Msmtp), but here are the specifics of how I set it up.\n\n\n\n\n<code>sudo apt-get install sendmail</code>\n\n\n\n\n\n#### Step 2. Installed `msmtp`:\n\n<code>sudo apt-get install msmtp</code>\n\n\n\n\n\n#### Step 3. Created the following file in my home directory (/home/sam/): `~/.msmtprc`\n\n\n\nThe original contents of the file for testing were:\n\n<pre><code>\n       # Example for a user configuration file ~/.msmtprc\n       #\n       # This file focuses on TLS and authentication. Features not used here include\n       # logging, timeouts, SOCKS proxies, TLS parameters, Delivery Status Notification\n       # (DSN) settings, and more.\n\n       # Set default values for all following accounts.\n       defaults\n\n       # Use the mail submission port 587 instead of the SMTP port 25.\n       port 587\n\n       # Always use STARTTLS.\n       tls on\n       tls_starttls on\n       tls_certcheck off\n       # A freemail service\n       account uw\n\n       # Host name of the SMTP server\n       host smtp.washington.edu\n\n       # Envelope-from address\n       from emu@uw.edu\n\n       # Authentication. The password is given using one of five methods, see below.\n       auth on\n       user samwhite\n\n       # Password method 3: Store the password directly in this file. Usually it is not\n       # a good idea to store passwords in plain text files. If you do it anyway, at\n       # least make sure that this file can only be read by yourself.\n       password myuwpassword\n\n       account default : uw\n</code></pre>\n\nThis is a configuration to allow emails to get sent via the Univ. of Washington email servers. Yes, I currently had UW password saved in this file, but will be addressing this issue below.\n\n\n\n#### Step 4. Changed permissions on `~/.msmtprc` to be readable/writable only by me (important, particularly if you've stored your password in this file!):\n\n<code>chmod 600 ~/.msmtprc</code>\n\n\n#### Step 5. Assigned `sendmail` to use `msmtp` with the `set` command (this sets the following command as a [positional parameter](https://www.gnu.org/software/bash/manual/html_node/Positional-Parameters.html) by adding to the `/etc/mail.rc` file:\n\n<code>echo \"set sendmail=/usr/bin/msmtp\" | sudo tee -a /etc/mail.rc</code>\n\n\n\nThis command pipers the output of `echo` to `sudo` and uses `tee -a` to append to our desired file (`/etc/mail.rc`).\n\n\n\n#### Step 5. Send a test email:\n\n\n<code>echo \"Job complete!\" | msmtp myuwemail@uw.edu</code>\n\n\n\nThat will send an email with no subject and the body of the email will contain \"Job complete!\".\n\nThat's the basic set up for this.\n\nTo use it in your workflow, you'd append that command to the end of any Bash command or in a separate Jupyter notebook cell that is queued to run after a previous cell completes it's job.\n\nExample:\n\n<code>echo \"This counts as a command\"; echo \"Job complete!\" | msmtp myuwemail@uw.edu</code>\n\n\n\nThis will run the first `echo` command. When that finishes, then the email command will run. You can get fancy and have different emails in response to how the running program exits (i.e. fails or is successful) and send different email responses, but I'm not going to get into that.\n\nAnyway, not bad! However, we want to make this a bit nicer and more secure.\n\n\n\n* * *\n\n\n\n\n\n### Improve security:\n\n\n#### Step 1. Generate a GPG Key:\n\n\n\nFollow the instructions under the [Creating an Encryption Key section at this link.](https://kb.iu.edu/d/awio)\n\nDO NOT CREATE A PASSWORD! JUST HIT ENTER WHEN AT THAT STEP.\n\nTechnically, this is does not follow proper security protocols, but this is better than having a plain text password, and setting it up this way is the only way the mail program will send without prompting the user for a password (which kills the automation we're trying to achieve).\n\n\n\n#### Step 2. Create an encrypted password file:\n\n<code>gpg --encrypt -o ~/.msmtp-password.gpg -r youremailaddress -</code>\n\n\n\nAfter entering that, type _your UW email password_(NOTE: You will not receive a new prompt, so just type it in), and then Enter. Then, press Ctrl-d.\n\n\n\n#### Step 3. Add the following line to your `~/.msmtprc` file:\n\n\n<code>passwordeval    \"gpg --quiet --for-your-eyes-only --no-tty --decrypt ~/.msmtp-password.gpg\"</code>\n\n\n\nHere's what the file looks like now:\n\n<pre><code>\n       # Example for a user configuration file ~/.msmtprc\n       #\n       # This file focuses on TLS and authentication. Features not used here include\n       # logging, timeouts, SOCKS proxies, TLS parameters, Delivery Status Notification\n       # (DSN) settings, and more.\n\n       # Set default values for all following accounts.\n       defaults\n\n       # Use the mail submission port 587 instead of the SMTP port 25.\n       port 587\n\n       # Always use STARTTLS.\n       tls on\n       tls_starttls on\n       tls_certcheck off\n\n       # Email account nickname\n       account uw\n\n       # Host name of the SMTP server\n       host smtp.washington.edu\n\n       # Envelope-from address\n       from emu@uw.edu\n\n       # Authentication. The password is given using one of five methods, see below.\n       auth on\n       user samwhite\n\n\n       # Password method 2: Store the password in an encrypted file, and tell msmtp\n       # which command to use to decrypt it. This is usually used with GnuPG, as in\n       # this example. Usually gpg-agent will ask once for the decryption password.\n       passwordeval    \"gpg --quiet --for-your-eyes-only --no-tty --decrypt ~/.msmtp-password.gpg\"\n\n       account default : uw\n\n</code></pre>\n\n\n\n#### Step 4. Change permissions on `~/.msmtp-password.gpg` so it's only readable/writable by you:\n\n\n<code>chmod 600 ~/.msmtp-password.gpg</code>\n\n\n\n\n\n#### Step 5. Send a test email like before:\n\n\n<code>echo \"Job complete!\" | msmtp myuwemail@uw.edu</code>\n\n\n\nThat's it for security.\n\n\n\n* * *\n\n\n\n\n\n### Add a subject to the emails:\n\n\n\n#### Step 1. Create `~/.default_subject.mail` and add the following lines to the file (substitute your own email address):\n\n\n\n<pre><code>\nTo: myuwemail@uw.edu\nFrom: [EMU]\nSubject: JOB COMPLETE!\n\n</code></pre>\n\nFeel free to change the Subject and/or From info to whatever you'd like.\n\n\n\n#### Step 2. Send message using `~/.default_subject.mail`:\n<code>cat ~/.default_subject.mail | msmtp myuwemail@uw.edu</code>\n\n\n\nTo use this in your workflow, you'll do just like before (but using the command immediately above) and append to the end of any Bash command.\n\n\n\n* * *\n\n\n\n\n\n### Make it short & sweet\n\n\n\nAppending those lines is going to be difficult to remember, is annoying to type out, and displays your email address (particularly if using a publicly hosted Jupyter notebook like most of us in lab do). Here's a nice way to remedy that.\n\n\n\n#### Step 1. Add email address as variable in `~/.bashrc`:\n\n\n\nAdd the following lines to the end of your `~/.bashrc` file:\n\n<pre><code>\n# Email address\nexport EMAIL=myuwemail@uw.edu\n</code></pre>\n\nYour email address is now saved in the variable `$EMAIL`. You will need to use the following command to load that information:\n\n\n<code>source ~/.bashrc</code>\n\n\n\nVerify that it worked:\n\n<code>echo \"$EMAIL\"</code>\n\n\n\nThat should spit out your email address and is ready to be used!\n\n\n\n#### Step 2. Add alias for full mail command to `~/.bash_aliases` file:\n\n\n<code>echo \"alias emailme='cat ~/.default_subject.mail | msmtp \"$EMAIL\"'\" >> ~/.bash_aliases</code>\n\n\n\nVerify that it worked:\n\n<code>source ~/.bash_aliases</code>\n\n\n<code>emailme</code>\n\n\n\nSo, from now on, all you have to do is append the command `emailme` to the end of any Bash commands and you'll get email when the job is finished!!! You can edit Steps 1 & 2 to use a variable other than \"EMAIL\" and an alias other than \"emailme\" - use whatever you'd like.\n","srcMarkdownNoYaml":"\n\n[After I finally resolved the installation of PB Jelly on Emu](https://robertslab.github.io/sams-notebook/posts/2017/2017-11-30-troubleshooting-pb-jelly-install-on-emu-continued/) (running Ubuntu 16.04), I've had a PB Jelly assembly running for the past two weeks! I've gotten tired of checking on its status (i.e. is it still running?) every day, so I dove in and figured out how to set up Emu to email me when the job is complete!\n\nTo get this going, I mainly followed this [msmtp ArchWiki guide.](https://wiki.archlinux.org/index.php/Msmtp), but here are the specifics of how I set it up.\n\n\n\n#### Step 1. Installed a mail server:\n\n<code>sudo apt-get install sendmail</code>\n\n\n\n\n\n#### Step 2. Installed `msmtp`:\n\n<code>sudo apt-get install msmtp</code>\n\n\n\n\n\n#### Step 3. Created the following file in my home directory (/home/sam/): `~/.msmtprc`\n\n\n\nThe original contents of the file for testing were:\n\n<pre><code>\n       # Example for a user configuration file ~/.msmtprc\n       #\n       # This file focuses on TLS and authentication. Features not used here include\n       # logging, timeouts, SOCKS proxies, TLS parameters, Delivery Status Notification\n       # (DSN) settings, and more.\n\n       # Set default values for all following accounts.\n       defaults\n\n       # Use the mail submission port 587 instead of the SMTP port 25.\n       port 587\n\n       # Always use STARTTLS.\n       tls on\n       tls_starttls on\n       tls_certcheck off\n       # A freemail service\n       account uw\n\n       # Host name of the SMTP server\n       host smtp.washington.edu\n\n       # Envelope-from address\n       from emu@uw.edu\n\n       # Authentication. The password is given using one of five methods, see below.\n       auth on\n       user samwhite\n\n       # Password method 3: Store the password directly in this file. Usually it is not\n       # a good idea to store passwords in plain text files. If you do it anyway, at\n       # least make sure that this file can only be read by yourself.\n       password myuwpassword\n\n       account default : uw\n</code></pre>\n\nThis is a configuration to allow emails to get sent via the Univ. of Washington email servers. Yes, I currently had UW password saved in this file, but will be addressing this issue below.\n\n\n\n#### Step 4. Changed permissions on `~/.msmtprc` to be readable/writable only by me (important, particularly if you've stored your password in this file!):\n\n<code>chmod 600 ~/.msmtprc</code>\n\n\n#### Step 5. Assigned `sendmail` to use `msmtp` with the `set` command (this sets the following command as a [positional parameter](https://www.gnu.org/software/bash/manual/html_node/Positional-Parameters.html) by adding to the `/etc/mail.rc` file:\n\n<code>echo \"set sendmail=/usr/bin/msmtp\" | sudo tee -a /etc/mail.rc</code>\n\n\n\nThis command pipers the output of `echo` to `sudo` and uses `tee -a` to append to our desired file (`/etc/mail.rc`).\n\n\n\n#### Step 5. Send a test email:\n\n\n<code>echo \"Job complete!\" | msmtp myuwemail@uw.edu</code>\n\n\n\nThat will send an email with no subject and the body of the email will contain \"Job complete!\".\n\nThat's the basic set up for this.\n\nTo use it in your workflow, you'd append that command to the end of any Bash command or in a separate Jupyter notebook cell that is queued to run after a previous cell completes it's job.\n\nExample:\n\n<code>echo \"This counts as a command\"; echo \"Job complete!\" | msmtp myuwemail@uw.edu</code>\n\n\n\nThis will run the first `echo` command. When that finishes, then the email command will run. You can get fancy and have different emails in response to how the running program exits (i.e. fails or is successful) and send different email responses, but I'm not going to get into that.\n\nAnyway, not bad! However, we want to make this a bit nicer and more secure.\n\n\n\n* * *\n\n\n\n\n\n### Improve security:\n\n\n#### Step 1. Generate a GPG Key:\n\n\n\nFollow the instructions under the [Creating an Encryption Key section at this link.](https://kb.iu.edu/d/awio)\n\nDO NOT CREATE A PASSWORD! JUST HIT ENTER WHEN AT THAT STEP.\n\nTechnically, this is does not follow proper security protocols, but this is better than having a plain text password, and setting it up this way is the only way the mail program will send without prompting the user for a password (which kills the automation we're trying to achieve).\n\n\n\n#### Step 2. Create an encrypted password file:\n\n<code>gpg --encrypt -o ~/.msmtp-password.gpg -r youremailaddress -</code>\n\n\n\nAfter entering that, type _your UW email password_(NOTE: You will not receive a new prompt, so just type it in), and then Enter. Then, press Ctrl-d.\n\n\n\n#### Step 3. Add the following line to your `~/.msmtprc` file:\n\n\n<code>passwordeval    \"gpg --quiet --for-your-eyes-only --no-tty --decrypt ~/.msmtp-password.gpg\"</code>\n\n\n\nHere's what the file looks like now:\n\n<pre><code>\n       # Example for a user configuration file ~/.msmtprc\n       #\n       # This file focuses on TLS and authentication. Features not used here include\n       # logging, timeouts, SOCKS proxies, TLS parameters, Delivery Status Notification\n       # (DSN) settings, and more.\n\n       # Set default values for all following accounts.\n       defaults\n\n       # Use the mail submission port 587 instead of the SMTP port 25.\n       port 587\n\n       # Always use STARTTLS.\n       tls on\n       tls_starttls on\n       tls_certcheck off\n\n       # Email account nickname\n       account uw\n\n       # Host name of the SMTP server\n       host smtp.washington.edu\n\n       # Envelope-from address\n       from emu@uw.edu\n\n       # Authentication. The password is given using one of five methods, see below.\n       auth on\n       user samwhite\n\n\n       # Password method 2: Store the password in an encrypted file, and tell msmtp\n       # which command to use to decrypt it. This is usually used with GnuPG, as in\n       # this example. Usually gpg-agent will ask once for the decryption password.\n       passwordeval    \"gpg --quiet --for-your-eyes-only --no-tty --decrypt ~/.msmtp-password.gpg\"\n\n       account default : uw\n\n</code></pre>\n\n\n\n#### Step 4. Change permissions on `~/.msmtp-password.gpg` so it's only readable/writable by you:\n\n\n<code>chmod 600 ~/.msmtp-password.gpg</code>\n\n\n\n\n\n#### Step 5. Send a test email like before:\n\n\n<code>echo \"Job complete!\" | msmtp myuwemail@uw.edu</code>\n\n\n\nThat's it for security.\n\n\n\n* * *\n\n\n\n\n\n### Add a subject to the emails:\n\n\n\n#### Step 1. Create `~/.default_subject.mail` and add the following lines to the file (substitute your own email address):\n\n\n\n<pre><code>\nTo: myuwemail@uw.edu\nFrom: [EMU]\nSubject: JOB COMPLETE!\n\n</code></pre>\n\nFeel free to change the Subject and/or From info to whatever you'd like.\n\n\n\n#### Step 2. Send message using `~/.default_subject.mail`:\n<code>cat ~/.default_subject.mail | msmtp myuwemail@uw.edu</code>\n\n\n\nTo use this in your workflow, you'll do just like before (but using the command immediately above) and append to the end of any Bash command.\n\n\n\n* * *\n\n\n\n\n\n### Make it short & sweet\n\n\n\nAppending those lines is going to be difficult to remember, is annoying to type out, and displays your email address (particularly if using a publicly hosted Jupyter notebook like most of us in lab do). Here's a nice way to remedy that.\n\n\n\n#### Step 1. Add email address as variable in `~/.bashrc`:\n\n\n\nAdd the following lines to the end of your `~/.bashrc` file:\n\n<pre><code>\n# Email address\nexport EMAIL=myuwemail@uw.edu\n</code></pre>\n\nYour email address is now saved in the variable `$EMAIL`. You will need to use the following command to load that information:\n\n\n<code>source ~/.bashrc</code>\n\n\n\nVerify that it worked:\n\n<code>echo \"$EMAIL\"</code>\n\n\n\nThat should spit out your email address and is ready to be used!\n\n\n\n#### Step 2. Add alias for full mail command to `~/.bash_aliases` file:\n\n\n<code>echo \"alias emailme='cat ~/.default_subject.mail | msmtp \"$EMAIL\"'\" >> ~/.bash_aliases</code>\n\n\n\nVerify that it worked:\n\n<code>source ~/.bash_aliases</code>\n\n\n<code>emailme</code>\n\n\n\nSo, from now on, all you have to do is append the command `emailme` to the end of any Bash commands and you'll get email when the job is finished!!! You can edit Steps 1 & 2 to use a variable other than \"EMAIL\" and an alias other than \"emailme\" - use whatever you'd like.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../../styles.css"],"toc":true,"toc-depth":5,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.42","editor":"source","theme":"darkly","page-layout":"full","code-background":true,"code-copy":true,"title-block-banner":true,"author":"Sam White","toc-title":"Contents","toc-location":"left","date":"2017-12-13 21:47:05+00:00","layout":"post","slug":"software-install-msmtp-for-email-notices-of-bash-job-completion-on-emu-ubuntu","title":"Software Install - MSMTP For Email Notices of Bash Job Completion on Emu (Ubuntu)","categories":["2017","Miscellaneous"],"tags":["email","emu","encryption","gpg","msmtp","password","ubuntu"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}