{"title":"Metagenomics - Geoduck Water Sample Assembly Comparisons with MetaQuast","markdown":{"yaml":{"author":"Sam White","toc-title":"Contents","toc-depth":5,"toc-location":"left","layout":"post","title":"Metagenomics - Geoduck Water Sample Assembly Comparisons with MetaQuast","date":"2019-04-03 20:39","tags":["metagenomics","Panopea generosa","metaquast","geoduck"],"categories":["2019","Miscellaneous"]},"headingText":"Send email when job starts, ends or runs into an error","containsRefs":false,"markdown":"\nAs part of addressing this [GitHub Issue on assessing taxonomic diversity in our metagenomics samples](https://github.com/RobertsLab/resources/issues/547), I decided to compare the individual sample assemblies [I made on 20190327 using Megahit](https://robertslab.github.io/sams-notebook/posts/2019/2019-03-27-Metagenome-Assemblies---P.generosa-Water-Samples-Trimmed-HiSeqX-Data-Using-Megahit-on-Mox/) and the assemblies that Emma made. Emma utilized [NGless](https://github.com/ngless-toolkit/ngless) on her cluster in Genome Sciences with the following scripts:\n\n- [ngless.job](http://eagle.fish.washington.edu/oyster/metagenomics_2019/ngless.job)\n\n```shell\n#!/bin/bash\n\n#$ -cwd\n#$ -S /bin/bash\n#$ -o ./output\n#$ -e ./output\n#$ -l mfree=3G\n#$ -pe serial 16\n#$ -R y\n\n#$ -m beas\n#$ -M emmats@uw.edu\n\n#cause a failing process to trigger a job failure to make errors easier to catch\nset -eo pipefail\n\n#Initialize and load modules\n. /etc/profile.d/modules.sh\nmodule purge\nmodule load modules{,-{init,gs/prod}} ngless/0.10.0\n\n#Script\nngless \\\n   /net/nunn/vol1/emmats/sequencing/geo_metaG/ngl.singleLibs \\\n   --trace \\\n   --keep-temporary-files \\\n   -j $NSLOTS \\\n   -t /data/scratch/ssd\n```\n\n---\n\n- [ngl.singleLibs](http://eagle.fish.washington.edu/oyster/metagenomics_2019/ngl.singleLibs)\n\n```shell\nngless \"0.10\"\nimport \"parallel\" version \"0.6\"\n\nsamples = readlines('MG7S2')\nsample = lock1(samples)\ninput = fastq(sample)\n\noutput = preprocess(input, keep_singles=False) using |read|:\n   read = substrim(read, min_quality=25)\n   if len(read) < 45:\n     discard\n\ncontigs = assemble(input)\nwrite(contigs, ofile='contigsM7S2.fa')\n\norfs = orf_find(contigs, is_metagenome=True)\nwrite(contigs, ofile='orfM7S2.fna')\n```\n\nI `rsync`'d all the assembly files to my computer (swoose) and ran [MetaQuast](http://quast.sourceforge.net/metaquast) locally. I did _not_ provide MetaQuast with individual reads, nor reference, as I just wanted a quick and dirty assessment of each of the assemblies. For a more in-depth comparison, I'm currently running [Anvi'o](http://merenlab.org/software/anvio/) on Mox.\n\nI ran MetaQuast with the following command:\n\n```shell\npython \\\n/home/sam/programs/quast-5.0.2/metaquast.py \\\n--threads=20 \\\n--min-contig=100 \\\n--labels=MG1_ets,MG1_sjw,MG2_ets,MG2_sjw,MG3_ets,MG3_sjw,MG5_ets,MG5_sjw,MG6_ets,MG6_sjw,MG7_ets,MG7_sjw \\\n/home/sam/data/metagenomics/P_generosa/contigsMG1S3.fa \\\n/home/sam/data/metagenomics/P_generosa/MG1.contigs.fa \\\n/home/sam/data/metagenomics/P_generosa/contigsMG2S4.fa \\\n/home/sam/data/metagenomics/P_generosa/MG2.contigs.fa \\\n/home/sam/data/metagenomics/P_generosa/contigsM32S1.fa \\\n/home/sam/data/metagenomics/P_generosa/MG3.contigs.fa \\\n/home/sam/data/metagenomics/P_generosa/contigsM5S6.fa \\\n/home/sam/data/metagenomics/P_generosa/MG5.contigs.fa \\\n/home/sam/data/metagenomics/P_generosa/contigsM6S5.fa \\\n/home/sam/data/metagenomics/P_generosa/MG6.contigs.fa \\\n/home/sam/data/metagenomics/P_generosa/contigsM7S2.fa \\\n/home/sam/data/metagenomics/P_generosa/MG7.contigs.fa\n```\n\nHere's how the sample names breakdown:\n\n| Sample | Develomental Stage (days post-fertilization) | pH Treatment |\n|--------|-------------------------|--------------|\n| MG1    | 13                      | 8.2          |\n| MG2    | 17                      | 8.2          |\n| MG3    | 6                       | 7.1          |\n| MG5    | 10                      | 8.2          |\n| MG6    | 13                      | 7.1          |\n| MG7    | 17                      | 7.1          |\n\n\n\n---\n\n# RESULTS\n\nThis took most of the day to run, but churns out some interesting info/data visualizations.\n\nBasically, MetaQuast takes the assemblies you provide it and runs a BLASTn against SILVA 16S rRNA database. After annotating your assemblies via BLASTn, it tries to match taxonomy to a subset (n=50) of NCBI prokaryotic reference genomes. As such, the taxonomic data in this particular assessment is limited and is somewhat obvious when looking at the data (e.g. most contigs don't align to any of the references). Consequently, the various \"Genome Statistics\" carry little weight on considering the impications of that data, in my opinion.\n\nHowever, it does provide an excellent summary on how big each of the assemblies are, N50, largest contigs, etc.\n\nOutput folder:\n\n- [20190403_metagenomics_pgen_metaquast_comparisons/](http://gannet.fish.washington.edu/Atumefaciens/20190403_metagenomics_pgen_metaquast_comparisons/)\n\nQuast Report (HTML):\n\n- [20190403_metagenomics_pgen_metaquast_comparisons/quast_results/results_2019_04_03_08_23_17/report.html](http://gannet.fish.washington.edu/Atumefaciens/20190403_metagenomics_pgen_metaquast_comparisons/quast_results/results_2019_04_03_08_23_17/report.html)\n\n- The Quast HTML report is a fully interactive report with ways to change views of the data, including contig browsers, heat maps, line graphs.\n\n  - Screen cap of default report view (look at the \"Stastics without Reference\" section at the bottom of the table):\n\n---\n\n  ![Screen cap of default report view](https://github.com/RobertsLab/sams-notebook/blob/master/images/screencaps/20190404_metagenomics_pgen_quast-01.png?raw=true)\n\n---\n\n  - Screen cap of the Icarus Contig Viewer:\n\n---\n\n![Screen cap of the Icarus Contig Viewer](https://github.com/RobertsLab/sams-notebook/blob/master/images/screencaps/20190404_metagenomics_pgen_quast-02.png?raw=true)\n\n\n---\n\nAt a cursory glance at the comparisons, I'd say that the assemblies that I generated with Megahit seem a bit more robust than those that were generated using NGless. However, when looking at the alignments/missassembly data, Emma's assemblies certainly seem to perform better. Overall, it seems like her assemblies were done in a more conservative fashion, resulting in smaller, but possibly more accurate, assemblies. Unfortunately, the NGless job submission is a bit of a black box, as Emma's cluster loaded it as part of a cluster \"module\" - meaning the settings for NGless are stored in there, not actually in the cluster job submission script. Maybe I'll contact Emma and see if she can pass along the NGless module contents.\n","srcMarkdownNoYaml":"\nAs part of addressing this [GitHub Issue on assessing taxonomic diversity in our metagenomics samples](https://github.com/RobertsLab/resources/issues/547), I decided to compare the individual sample assemblies [I made on 20190327 using Megahit](https://robertslab.github.io/sams-notebook/posts/2019/2019-03-27-Metagenome-Assemblies---P.generosa-Water-Samples-Trimmed-HiSeqX-Data-Using-Megahit-on-Mox/) and the assemblies that Emma made. Emma utilized [NGless](https://github.com/ngless-toolkit/ngless) on her cluster in Genome Sciences with the following scripts:\n\n- [ngless.job](http://eagle.fish.washington.edu/oyster/metagenomics_2019/ngless.job)\n\n```shell\n#!/bin/bash\n\n#$ -cwd\n#$ -S /bin/bash\n#$ -o ./output\n#$ -e ./output\n#$ -l mfree=3G\n#$ -pe serial 16\n#$ -R y\n\n# Send email when job starts, ends or runs into an error\n#$ -m beas\n#$ -M emmats@uw.edu\n\n#cause a failing process to trigger a job failure to make errors easier to catch\nset -eo pipefail\n\n#Initialize and load modules\n. /etc/profile.d/modules.sh\nmodule purge\nmodule load modules{,-{init,gs/prod}} ngless/0.10.0\n\n#Script\nngless \\\n   /net/nunn/vol1/emmats/sequencing/geo_metaG/ngl.singleLibs \\\n   --trace \\\n   --keep-temporary-files \\\n   -j $NSLOTS \\\n   -t /data/scratch/ssd\n```\n\n---\n\n- [ngl.singleLibs](http://eagle.fish.washington.edu/oyster/metagenomics_2019/ngl.singleLibs)\n\n```shell\nngless \"0.10\"\nimport \"parallel\" version \"0.6\"\n\nsamples = readlines('MG7S2')\nsample = lock1(samples)\ninput = fastq(sample)\n\noutput = preprocess(input, keep_singles=False) using |read|:\n   read = substrim(read, min_quality=25)\n   if len(read) < 45:\n     discard\n\ncontigs = assemble(input)\nwrite(contigs, ofile='contigsM7S2.fa')\n\norfs = orf_find(contigs, is_metagenome=True)\nwrite(contigs, ofile='orfM7S2.fna')\n```\n\nI `rsync`'d all the assembly files to my computer (swoose) and ran [MetaQuast](http://quast.sourceforge.net/metaquast) locally. I did _not_ provide MetaQuast with individual reads, nor reference, as I just wanted a quick and dirty assessment of each of the assemblies. For a more in-depth comparison, I'm currently running [Anvi'o](http://merenlab.org/software/anvio/) on Mox.\n\nI ran MetaQuast with the following command:\n\n```shell\npython \\\n/home/sam/programs/quast-5.0.2/metaquast.py \\\n--threads=20 \\\n--min-contig=100 \\\n--labels=MG1_ets,MG1_sjw,MG2_ets,MG2_sjw,MG3_ets,MG3_sjw,MG5_ets,MG5_sjw,MG6_ets,MG6_sjw,MG7_ets,MG7_sjw \\\n/home/sam/data/metagenomics/P_generosa/contigsMG1S3.fa \\\n/home/sam/data/metagenomics/P_generosa/MG1.contigs.fa \\\n/home/sam/data/metagenomics/P_generosa/contigsMG2S4.fa \\\n/home/sam/data/metagenomics/P_generosa/MG2.contigs.fa \\\n/home/sam/data/metagenomics/P_generosa/contigsM32S1.fa \\\n/home/sam/data/metagenomics/P_generosa/MG3.contigs.fa \\\n/home/sam/data/metagenomics/P_generosa/contigsM5S6.fa \\\n/home/sam/data/metagenomics/P_generosa/MG5.contigs.fa \\\n/home/sam/data/metagenomics/P_generosa/contigsM6S5.fa \\\n/home/sam/data/metagenomics/P_generosa/MG6.contigs.fa \\\n/home/sam/data/metagenomics/P_generosa/contigsM7S2.fa \\\n/home/sam/data/metagenomics/P_generosa/MG7.contigs.fa\n```\n\nHere's how the sample names breakdown:\n\n| Sample | Develomental Stage (days post-fertilization) | pH Treatment |\n|--------|-------------------------|--------------|\n| MG1    | 13                      | 8.2          |\n| MG2    | 17                      | 8.2          |\n| MG3    | 6                       | 7.1          |\n| MG5    | 10                      | 8.2          |\n| MG6    | 13                      | 7.1          |\n| MG7    | 17                      | 7.1          |\n\n\n\n---\n\n# RESULTS\n\nThis took most of the day to run, but churns out some interesting info/data visualizations.\n\nBasically, MetaQuast takes the assemblies you provide it and runs a BLASTn against SILVA 16S rRNA database. After annotating your assemblies via BLASTn, it tries to match taxonomy to a subset (n=50) of NCBI prokaryotic reference genomes. As such, the taxonomic data in this particular assessment is limited and is somewhat obvious when looking at the data (e.g. most contigs don't align to any of the references). Consequently, the various \"Genome Statistics\" carry little weight on considering the impications of that data, in my opinion.\n\nHowever, it does provide an excellent summary on how big each of the assemblies are, N50, largest contigs, etc.\n\nOutput folder:\n\n- [20190403_metagenomics_pgen_metaquast_comparisons/](http://gannet.fish.washington.edu/Atumefaciens/20190403_metagenomics_pgen_metaquast_comparisons/)\n\nQuast Report (HTML):\n\n- [20190403_metagenomics_pgen_metaquast_comparisons/quast_results/results_2019_04_03_08_23_17/report.html](http://gannet.fish.washington.edu/Atumefaciens/20190403_metagenomics_pgen_metaquast_comparisons/quast_results/results_2019_04_03_08_23_17/report.html)\n\n- The Quast HTML report is a fully interactive report with ways to change views of the data, including contig browsers, heat maps, line graphs.\n\n  - Screen cap of default report view (look at the \"Stastics without Reference\" section at the bottom of the table):\n\n---\n\n  ![Screen cap of default report view](https://github.com/RobertsLab/sams-notebook/blob/master/images/screencaps/20190404_metagenomics_pgen_quast-01.png?raw=true)\n\n---\n\n  - Screen cap of the Icarus Contig Viewer:\n\n---\n\n![Screen cap of the Icarus Contig Viewer](https://github.com/RobertsLab/sams-notebook/blob/master/images/screencaps/20190404_metagenomics_pgen_quast-02.png?raw=true)\n\n\n---\n\nAt a cursory glance at the comparisons, I'd say that the assemblies that I generated with Megahit seem a bit more robust than those that were generated using NGless. However, when looking at the alignments/missassembly data, Emma's assemblies certainly seem to perform better. Overall, it seems like her assemblies were done in a more conservative fashion, resulting in smaller, but possibly more accurate, assemblies. Unfortunately, the NGless job submission is a bit of a black box, as Emma's cluster loaded it as part of a cluster \"module\" - meaning the settings for NGless are stored in there, not actually in the cluster job submission script. Maybe I'll contact Emma and see if she can pass along the NGless module contents.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../../styles.css"],"toc":true,"toc-depth":5,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.42","editor":"source","theme":"darkly","page-layout":"full","code-background":true,"code-copy":true,"title-block-banner":true,"author":"Sam White","toc-title":"Contents","toc-location":"left","layout":"post","title":"Metagenomics - Geoduck Water Sample Assembly Comparisons with MetaQuast","date":"2019-04-03 20:39","tags":["metagenomics","Panopea generosa","metaquast","geoduck"],"categories":["2019","Miscellaneous"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}