{"title":"Genome Comparison - Pgenerosa_v074 vs C.gigas NCBI with MUMmer on Mox","markdown":{"yaml":{"author":"Sam White","toc-title":"Contents","toc-depth":5,"toc-location":"left","layout":"post","title":"Genome Comparison - Pgenerosa_v074 vs C.gigas NCBI with MUMmer on Mox","date":"2019-08-07 08:13","tags":["Panopea generosa","geoduck","Crassostrea gigas","Pacific oyster","MUMmer","mox"],"categories":["2019","Miscellaneous"]},"headingText":"Job Name","containsRefs":false,"markdown":"\nIn continuing to further improve our geoduck genome annotation, I'm attempting to figure out why [Scaffold 1 of our assembly doesn't have any annotations](https://github.com/RobertsLab/resources/issues/721). As part of that I've decided to perform a series of genome comparisons and see how they match up, with an emphasis on Scaffold 1, using [MUMmer (v4)](https://github.com/mummer4/mummer) (specifically, `nucmer` for nucleotide comparisons). This software is specifically designed to do this type of comparison.\n\nBasically, MUMmer will take a query genome assembly (Pgenerosa_v074 in this case), align it to a reference genome, and determine contig similarities/differences. So, this should provide further insight on what is happening in Pgenerosa_v074 Scaffold 1, when compared to related (or different) species' genomes.\n\nINPUT FILES:\n\nQuery:\n\n- [Pgenerosa_v074.fa](http://owl.fish.washington.edu/halfshell/genomic-databank/Pgenerosa_v074.fa)\n\nReference genome (_Crassostrea gigas_ - Pacific oyster):\n\n- [GCrassostrea_gigas.oyster_v9.dna_sm.toplevel.fa](http://owl.fish.washington.edu/halfshell/genomic-databank/Crassostrea_gigas.oyster_v9.dna_sm.toplevel.fa) (NCBI via our [Genomics Resources wiki](http://owl.fish.washington.edu/halfshell/genomic-databank/))\n\n\nThis was run using MUMmer v4 on Mox using the SBATCH script below.\n\nSBATCH script (GitHub):\n\n- [20190807_pgen_mummer_pgen-v074_cgig-ncbi.sh](https://github.com/RobertsLab/sams-notebook/blob/master/sbatch_scripts/20190807_pgen_mummer_pgen-v074_cgig-ncbi.sh)\n\n```shell\n#!/bin/bash\n#SBATCH --job-name=mummer_pgen074\n## Allocation Definition\n#SBATCH --account=coenv\n#SBATCH --partition=coenv\n## Resources\n## Nodes\n#SBATCH --nodes=1\n## Walltime (days-hours:minutes:seconds format)\n#SBATCH --time=1-00:00:00\n## Memory per node\n#SBATCH --mem=120G\n##turn on e-mail notification\n#SBATCH --mail-type=ALL\n#SBATCH --mail-user=samwhite@uw.edu\n## Specify the working directory for this job\n#SBATCH --workdir=/gscratch/scrubbed/samwhite/outputs/20190807_pgen_mummer_pgen-v074_cgig-ncbi\n\n# Exit if any command fails\nset -e\n\n# Load Python Mox module for Python module availability\n\nmodule load intel-python3_2017\n\n# Load Open MPI module for parallel, multi-node processing\n\nmodule load icc_19-ompi_3.1.2\n\n# SegFault fix?\nexport THREADS_DAEMON_MODEL=1\n\n# Document programs in PATH (primarily for program version ID)\n\ndate >> system_path.log\necho \"\" >> system_path.log\necho \"System PATH for $SLURM_JOB_ID\" >> system_path.log\necho \"\" >> system_path.log\nprintf \"%0.s-\" {1..10} >> system_path.log\necho \"${PATH}\" | tr : \\\\n >> system_path.log\n\n### Set variables\n# CPUs to use\nthreads=28\n\n# Filename prefix\nprefix=\"pgen-v074_cgig-ncbi\"\npga1_coords=\"PGA_scaffold1.coords.txt\"\n\n# Program paths\nnucmer=\"/gscratch/srlab/programs/mummer-4.0.0beta2/nucmer\"\nshow_coords=\"/gscratch/srlab/programs/mummer-4.0.0beta2/show-coords\"\n\n# C.gigas NCBI FastA\ncgig_fasta=\"/gscratch/srlab/sam/data/C_gigas/genomes/Crassostrea_gigas.oyster_v9.dna_sm.toplevel.fa\"\n\n# P.generosa Pgenerosa_v074 FastA\npgen_v074_fasta=\"/gscratch/srlab/sam/data/P_generosa/genomes/Pgenerosa_v074.fa\"\n\n### Run MUMmer (nucmer)\n# Compares pgen_v074 (query) to cgig-ncbi (reference)\n\"${nucmer}\" \\\n--prefix=\"${prefix}\" \\\n--threads=\"${threads}\" \\\n\"${cgig_fasta}\" \\\n\"${pgen_v074_fasta}\"\n\n# Parse nucmer delta output into more userfriendly format\n# -b useful for syteny - merges overlapping alignments\n# -c show percent coverage info\n# -q option sorts by query\n\"${show_coords}\" \\\n-b \\\n-c \\\n-q \\\n\"${prefix}\".delta \\\n> \"${prefix}\".coords.txt\n\n# Parse out PGA_scaffold1__77_contigs__length_89643857\nhead -n 5 \"${prefix}\".coords.txt > \"${pga1_coords}\"\ngrep \"PGA_scaffold1__77_contigs__length_89643857\" \"${prefix}\".coords.txt >> \"${pga1_coords}\"\n```\n\n---\n\n# RESULTS\n\nThis was took a bit over an hour. Significantly longer than the _C.virginica_ comparison (which took only 3 mins!).\n\n![pgen-v074 vs cgig-ncbi MUMmer runtime screencap](https://github.com/RobertsLab/sams-notebook/blob/master/images/screencaps/20190807_mummer_pgen-074_cgig-ncbi_runtime.png?raw=true)\n\nOutput folder:\n\n- [20190807_pgen_mummer_pgen-v074_cgig-ncbi/](https://gannet.fish.washington.edu/Atumefaciens/20190807_pgen_mummer_pgen-v074_cgig-ncbi)\n\nMUMmer delta file (text):\n\n- [20190807_pgen_mummer_pgen-v074_cgig-ncbi/pgen-v074_cgig-ncbi.delta](https://gannet.fish.washington.edu/Atumefaciens/20190807_pgen_mummer_pgen-v074_cgig-ncbi/pgen-v074_cgig-ncbi.delta)\n\nDelta file format is explained here: [http://mummer.sourceforge.net/manual/#nucmeroutput](http://mummer.sourceforge.net/manual/#nucmeroutput)\n\nMUMmer coordinates file (text):\n\n- [20190807_pgen_mummer_pgen-v074_cgig-ncbi/pgen-v074_cgig-ncbi.coords.txt](https://gannet.fish.washington.edu/Atumefaciens/20190807_pgen_mummer_pgen-v074_cgig-ncbi/pgen-v074_cgig-ncbi.coords.txt)\n\nMUMmer PGA_scaffold1 coordinates file (text):\n\n- [20190807_pgen_mummer_pgen-v074_cgig-ncbi/PGA_scaffold1.coords.txt](https://gannet.fish.washington.edu/Atumefaciens/20190807_pgen_mummer_pgen-v074_cgig-ncbi/PGA_scaffold1.coords.txt)\n\n\nThe coordinates files have a header like this:\n\n| [S1]  |   [E1] | [S2]  |   [E2] | [LEN 1] | [LEN 2] | [COV R] | [COV Q] | [TAGS] |\n|-------|--------|-------|--------|---------|---------|---------|---------|--------|\n\nThe column labels represent the following:\n\n```\n[S1]    Start of the alignment region in the reference sequence.\n\n[E1]    End of the alignment region in the reference sequence.\n\n[S2]    Start of the alignment region in the query sequence.\n\n[E2]    End of the alignment region in the query sequence.\n\n[LEN 1] Length of the alignment region in the reference sequence,\n    measured in nucleotides.\n\n[LEN 2] Length of the alignment region in the query sequence, measured in nucleotides.\n\n[LEN R] Length of the reference sequence.\n\n[LEN Q] Length of the query sequence.\n\n[COV R] Percent coverage of the alignment on the reference sequence, calculated as [LEN 1] / [LEN R].\n\n[COV Q] Percent coverage of the alignment on the query sequence, calculated as [LEN 2] / [LEN Q].\n```\n\nI'm currently exploring some options for visualizing this data:\n\n- [Dot](https://github.com/dnanexus/dot): This is the current forerunner, due to simplicity and ease of understanding. Will probably be the fastest way to get some sort of information about these genome comparisons.\n\n- [CIRCOS](http://circos.ca/): This is _very_ cool and designed for just this type of analysis. However, seems like the learning curve might be a bit steep (i.e. time consuming). I'll probably play around with this at some point.\n\n- [MUMmerplots with ggplot2](https://jmonlong.github.io/Hippocamplus/2017/09/19/mummerplots-with-ggplot2/): Uses R to reproduce the dotplots that can be generated with MUMmer. I've messed with this and, although easy to plug my data in to, the results seems to be confusing. May need more time with it, though.\n","srcMarkdownNoYaml":"\nIn continuing to further improve our geoduck genome annotation, I'm attempting to figure out why [Scaffold 1 of our assembly doesn't have any annotations](https://github.com/RobertsLab/resources/issues/721). As part of that I've decided to perform a series of genome comparisons and see how they match up, with an emphasis on Scaffold 1, using [MUMmer (v4)](https://github.com/mummer4/mummer) (specifically, `nucmer` for nucleotide comparisons). This software is specifically designed to do this type of comparison.\n\nBasically, MUMmer will take a query genome assembly (Pgenerosa_v074 in this case), align it to a reference genome, and determine contig similarities/differences. So, this should provide further insight on what is happening in Pgenerosa_v074 Scaffold 1, when compared to related (or different) species' genomes.\n\nINPUT FILES:\n\nQuery:\n\n- [Pgenerosa_v074.fa](http://owl.fish.washington.edu/halfshell/genomic-databank/Pgenerosa_v074.fa)\n\nReference genome (_Crassostrea gigas_ - Pacific oyster):\n\n- [GCrassostrea_gigas.oyster_v9.dna_sm.toplevel.fa](http://owl.fish.washington.edu/halfshell/genomic-databank/Crassostrea_gigas.oyster_v9.dna_sm.toplevel.fa) (NCBI via our [Genomics Resources wiki](http://owl.fish.washington.edu/halfshell/genomic-databank/))\n\n\nThis was run using MUMmer v4 on Mox using the SBATCH script below.\n\nSBATCH script (GitHub):\n\n- [20190807_pgen_mummer_pgen-v074_cgig-ncbi.sh](https://github.com/RobertsLab/sams-notebook/blob/master/sbatch_scripts/20190807_pgen_mummer_pgen-v074_cgig-ncbi.sh)\n\n```shell\n#!/bin/bash\n## Job Name\n#SBATCH --job-name=mummer_pgen074\n## Allocation Definition\n#SBATCH --account=coenv\n#SBATCH --partition=coenv\n## Resources\n## Nodes\n#SBATCH --nodes=1\n## Walltime (days-hours:minutes:seconds format)\n#SBATCH --time=1-00:00:00\n## Memory per node\n#SBATCH --mem=120G\n##turn on e-mail notification\n#SBATCH --mail-type=ALL\n#SBATCH --mail-user=samwhite@uw.edu\n## Specify the working directory for this job\n#SBATCH --workdir=/gscratch/scrubbed/samwhite/outputs/20190807_pgen_mummer_pgen-v074_cgig-ncbi\n\n# Exit if any command fails\nset -e\n\n# Load Python Mox module for Python module availability\n\nmodule load intel-python3_2017\n\n# Load Open MPI module for parallel, multi-node processing\n\nmodule load icc_19-ompi_3.1.2\n\n# SegFault fix?\nexport THREADS_DAEMON_MODEL=1\n\n# Document programs in PATH (primarily for program version ID)\n\ndate >> system_path.log\necho \"\" >> system_path.log\necho \"System PATH for $SLURM_JOB_ID\" >> system_path.log\necho \"\" >> system_path.log\nprintf \"%0.s-\" {1..10} >> system_path.log\necho \"${PATH}\" | tr : \\\\n >> system_path.log\n\n### Set variables\n# CPUs to use\nthreads=28\n\n# Filename prefix\nprefix=\"pgen-v074_cgig-ncbi\"\npga1_coords=\"PGA_scaffold1.coords.txt\"\n\n# Program paths\nnucmer=\"/gscratch/srlab/programs/mummer-4.0.0beta2/nucmer\"\nshow_coords=\"/gscratch/srlab/programs/mummer-4.0.0beta2/show-coords\"\n\n# C.gigas NCBI FastA\ncgig_fasta=\"/gscratch/srlab/sam/data/C_gigas/genomes/Crassostrea_gigas.oyster_v9.dna_sm.toplevel.fa\"\n\n# P.generosa Pgenerosa_v074 FastA\npgen_v074_fasta=\"/gscratch/srlab/sam/data/P_generosa/genomes/Pgenerosa_v074.fa\"\n\n### Run MUMmer (nucmer)\n# Compares pgen_v074 (query) to cgig-ncbi (reference)\n\"${nucmer}\" \\\n--prefix=\"${prefix}\" \\\n--threads=\"${threads}\" \\\n\"${cgig_fasta}\" \\\n\"${pgen_v074_fasta}\"\n\n# Parse nucmer delta output into more userfriendly format\n# -b useful for syteny - merges overlapping alignments\n# -c show percent coverage info\n# -q option sorts by query\n\"${show_coords}\" \\\n-b \\\n-c \\\n-q \\\n\"${prefix}\".delta \\\n> \"${prefix}\".coords.txt\n\n# Parse out PGA_scaffold1__77_contigs__length_89643857\nhead -n 5 \"${prefix}\".coords.txt > \"${pga1_coords}\"\ngrep \"PGA_scaffold1__77_contigs__length_89643857\" \"${prefix}\".coords.txt >> \"${pga1_coords}\"\n```\n\n---\n\n# RESULTS\n\nThis was took a bit over an hour. Significantly longer than the _C.virginica_ comparison (which took only 3 mins!).\n\n![pgen-v074 vs cgig-ncbi MUMmer runtime screencap](https://github.com/RobertsLab/sams-notebook/blob/master/images/screencaps/20190807_mummer_pgen-074_cgig-ncbi_runtime.png?raw=true)\n\nOutput folder:\n\n- [20190807_pgen_mummer_pgen-v074_cgig-ncbi/](https://gannet.fish.washington.edu/Atumefaciens/20190807_pgen_mummer_pgen-v074_cgig-ncbi)\n\nMUMmer delta file (text):\n\n- [20190807_pgen_mummer_pgen-v074_cgig-ncbi/pgen-v074_cgig-ncbi.delta](https://gannet.fish.washington.edu/Atumefaciens/20190807_pgen_mummer_pgen-v074_cgig-ncbi/pgen-v074_cgig-ncbi.delta)\n\nDelta file format is explained here: [http://mummer.sourceforge.net/manual/#nucmeroutput](http://mummer.sourceforge.net/manual/#nucmeroutput)\n\nMUMmer coordinates file (text):\n\n- [20190807_pgen_mummer_pgen-v074_cgig-ncbi/pgen-v074_cgig-ncbi.coords.txt](https://gannet.fish.washington.edu/Atumefaciens/20190807_pgen_mummer_pgen-v074_cgig-ncbi/pgen-v074_cgig-ncbi.coords.txt)\n\nMUMmer PGA_scaffold1 coordinates file (text):\n\n- [20190807_pgen_mummer_pgen-v074_cgig-ncbi/PGA_scaffold1.coords.txt](https://gannet.fish.washington.edu/Atumefaciens/20190807_pgen_mummer_pgen-v074_cgig-ncbi/PGA_scaffold1.coords.txt)\n\n\nThe coordinates files have a header like this:\n\n| [S1]  |   [E1] | [S2]  |   [E2] | [LEN 1] | [LEN 2] | [COV R] | [COV Q] | [TAGS] |\n|-------|--------|-------|--------|---------|---------|---------|---------|--------|\n\nThe column labels represent the following:\n\n```\n[S1]    Start of the alignment region in the reference sequence.\n\n[E1]    End of the alignment region in the reference sequence.\n\n[S2]    Start of the alignment region in the query sequence.\n\n[E2]    End of the alignment region in the query sequence.\n\n[LEN 1] Length of the alignment region in the reference sequence,\n    measured in nucleotides.\n\n[LEN 2] Length of the alignment region in the query sequence, measured in nucleotides.\n\n[LEN R] Length of the reference sequence.\n\n[LEN Q] Length of the query sequence.\n\n[COV R] Percent coverage of the alignment on the reference sequence, calculated as [LEN 1] / [LEN R].\n\n[COV Q] Percent coverage of the alignment on the query sequence, calculated as [LEN 2] / [LEN Q].\n```\n\nI'm currently exploring some options for visualizing this data:\n\n- [Dot](https://github.com/dnanexus/dot): This is the current forerunner, due to simplicity and ease of understanding. Will probably be the fastest way to get some sort of information about these genome comparisons.\n\n- [CIRCOS](http://circos.ca/): This is _very_ cool and designed for just this type of analysis. However, seems like the learning curve might be a bit steep (i.e. time consuming). I'll probably play around with this at some point.\n\n- [MUMmerplots with ggplot2](https://jmonlong.github.io/Hippocamplus/2017/09/19/mummerplots-with-ggplot2/): Uses R to reproduce the dotplots that can be generated with MUMmer. I've messed with this and, although easy to plug my data in to, the results seems to be confusing. May need more time with it, though.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../../styles.css"],"toc":true,"toc-depth":5,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.42","editor":"source","theme":"darkly","page-layout":"full","code-background":true,"code-copy":true,"title-block-banner":true,"author":"Sam White","toc-title":"Contents","toc-location":"left","layout":"post","title":"Genome Comparison - Pgenerosa_v074 vs C.gigas NCBI with MUMmer on Mox","date":"2019-08-07 08:13","tags":["Panopea generosa","geoduck","Crassostrea gigas","Pacific oyster","MUMmer","mox"],"categories":["2019","Miscellaneous"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}